%%% File:         b10_CharText.mkiv
%%% Author:       Joaquín Ataz-López
%%% Begun:        July 2020
%%% concluded:    July 2020
%%% Contents:     It is actually an amalgamation of issues that are
%%% raised in this chapter, and the criterion that
%%% unified them is somewhat forced: Section 1 could be in
%%% the chapter dedicated to the source file (in fact
%%% was in the first version of it);  2 in the
%%% chapter dedicated to fonts: because although they are not
%%% characteristics of the format itself, they are
%%% somewhat similar. 3 is horizontal space; in the
%%% first versions I put it together with  vertical space in
%%% a chapter titled "Blank space". The 4th and 5th
%%% are more difficult to locate. I finally opted for this
%%% chapter that is a "poutpurri".
%%%
%%% Edited by: Emacs + AuTeX - And at times vim + context-plugin
%%%

\environment introCTX_env

\startcomponent b10_CharText

% *    Chapter 

\startchapter
  [title={Caractères, mots, texte et espace horizontal},
  reference=cap:chartext]

\TocChap

L'élément de base de tous les documents textuels est le caractère : les caractères sont regroupés en mots, qui à leur tour forment des lignes qui constituent les paragraphes qui composent les pages.

Le présent chapitre, qui commence par \quotation{\em caractère}, explique certains des utilitaires de \ConTeXt\ relatifs aux caractères, aux mots et au texte.

% **   Section    caractère hors clavier

% TODO Garulfo : mettre tout cela en annexe, ou plus loin, ce n'est pas la priorité du débutant.

\startsection
  [title={Obtenir des caractères qui ne sont pas normalement accessibles à partir du clavier}]

Dans un fichier texte codé en UTF-8 (voir \in{section}[sec:encodage]), nous pouvons utiliser n'importe quel caractère ou symbole, aussi bien des langues vivantes que de nombreuses langues dites mortes. Mais, comme les possibilités d'un clavier sont limitées, la plupart des caractères et symboles autorisés en UTF-8 ne peuvent normalement pas être obtenus directement du clavier. C'est notamment le cas de nombreux diacritiques, c'est-à-dire des signes placés au-dessus (ou au-dessous) de certaines lettres, leur conférant une valeur particulière ; mais aussi de nombreux autres caractères comme les symboles mathématiques, les ligatures traditionnelles, etc. Nous pouvons obtenir beaucoup de ces caractères avec \ConTeXt\ en utilisant des commandes.

% ***  SubSection diacritiques

% TODO Garulfo et si on mettait tout cela en annexe ?

\startsubsection
  [title={Diacritiques et lettres spéciales}]

Presque toutes les langues occidentales ont des diacritiques (à l'exception importante de l'anglais pour l'essentiel) et en général, les claviers peuvent générer les diacritiques correspondant aux langues régionales. Ainsi, un clavier espagnol peut générer tous les signes diacritiques nécessaires à l'espagnol (essentiellement les accents et le tréma) ainsi que certains signes diacritiques utilisés dans d'autres langues comme le catalan (accents graves et cédilles) ou le français (cédilles, accents graves et circonflexes) ; mais pas, par exemple, certains signes diacritiques utilisés en portugais, comme le tilde sur certaines voyelles dans des mots comme \quotation{navegaç\~ao}.

\TeX\ a été conçu aux États-Unis où les claviers ne permettent généralement pas d'obtenir les diacritiques ; Donald Knuth lui a donc donné un ensemble de commandes qui permettent d'obtenir presque tous les diacritiques connus (du moins dans les langues utilisant l'alphabet latin). Si nous utilisons un clavier espagnol, cela n'a pas beaucoup de sens d'utiliser ces commandes pour obtenir les diacritiques qui peuvent être obtenus directement à partir du clavier. Il est néanmoins important de savoir que ces commandes existent, et ce qu'elles sont, puisque les claviers espagnols (ou italiens, ou français...) ne permettent pas de générer tous les diacritiques possibles.

\PlaceMacro{aacute} 
\PlaceMacro{eacute} 
\PlaceMacro{iacute} 
\PlaceMacro{oacute} 
\PlaceMacro{uacute}
\PlaceMacro{agrave}
\PlaceMacro{egrave}
\PlaceMacro{igrave}
\PlaceMacro{ograve}
\PlaceMacro{ugrave}
\PlaceMacro{acircumflex}
\PlaceMacro{ecircumflex}
\PlaceMacro{icircumflex}
\PlaceMacro{ocircumflex}
\PlaceMacro{ucircumflex}
\PlaceMacro{adiaeresis}
\PlaceMacro{ediaeresis}
\PlaceMacro{idiaeresis}
\PlaceMacro{odiaeresis}
\PlaceMacro{udiaeresis}
\PlaceMacro{amacron}
\PlaceMacro{emacron}
\PlaceMacro{imacron}
\PlaceMacro{omacron}
\PlaceMacro{umacron}
\PlaceMacro{atilde}
\PlaceMacro{etilde}
\PlaceMacro{itilde}
\PlaceMacro{otilde}
\PlaceMacro{utilde}
\PlaceMacro{u}
\PlaceMacro{abreve}
\PlaceMacro{ebreve}
\PlaceMacro{obreve}
\PlaceMacro{ibreve}
\PlaceMacro{ubreve}

\placetable
  [here]
  [tbl:diacritics]
  {\tfx Accents and other diacritics}
  {
\starttabulate[|l|l|l|l|]
\HL
\NC{\bf Nom}
\NC{\bf Caractère}
\NC{\bf Abréviation}
\NC{\bf Commande}
\NR
\HL
\NC Accent aiguë 
\NC \' u
\NC \tex{'} u
\NC \tex{uacute}
\NR
\NC Accent grave
\NC \` u
\NC \tex{`} u
\NC \tex{ugrave}
\NR
\NC Accent circonflexe
\NC \^ u
\NC \tex{^} u
\NC \tex{ucircumflex}
\NR
\NC Accent tréma
\NC \" u
\NC \tex{"} u
\NC \tex{udiaeresis} ou \tex{uumlaut}
\NR
\NC Tilde
\NC \~ u
\NC \tex{\lettertilde} u
\NC \tex{utilde}
\NR
\NC Macron 
\NC \= u
\NC \tex{=} u
\NC \tex{umacron}
\NR
\NC Brève
\NC \u u
\NC \tex{u} u
\NC \tex{ubreve}
\NR
\HL
\stoptabulate
}
  

Dans la \in{table}[tbl:diacritics] nous trouvons les commandes et abréviations qui nous permettent d'obtenir ces diacritiques. Dans tous les cas, il importe peu que nous utilisions la commande ou l'abréviation. Dans le tableau, j'ai utilisé la lettre \quote{u} comme exemple, mais ces commandes fonctionnent avec n'importe quelle voyelle (la plupart d'entre elles \footnote{Parmi les commandes trouvées dans \in{table}[tbl:diacritics] le tilde ne fonctionne pas avec la lettre \quote{e}, et je ne sais pas pourquoi.}) et aussi avec certaines consonnes et certaines semi-voyelles.

\startitemize

\item Comme la plupart des commandes abrégées sont des {\em symboles de contrôle} (voir \in{section} [sec:commands themselves]), la lettre sur laquelle le diacritique doit tomber peut être écrite immédiatement après la commande, ou séparée de celle-ci. Ainsi, par exemple, pour obtenir le \quote{\~a} portugais, on peut écrire les caractères 
\tex{lettertilde a} ou 
\tex{lettertilde\textvisiblespace a}.
\footnote{Nous rappelons que dans ce document, nous représentons les espaces vides, lorsqu'il est important de les voir, par le \quote{\textvisiblespace}.} Mais dans le cas du brève (\tex{u}), lorsqu'il s'agit d'un {\em mot de contrôle} l'espace blanc est obligatoire.

\item Dans le cas de la version longue de la commande, la lettre sur laquelle tombe le diacritique sera la première lettre du nom de la commande. Ainsi, par exemple, 
\tex{emacron} placera un macron au-dessus d'un \quote{e} minuscule (\emacron),
\tex{Emacron} fera de même au-dessus d'un \quote{E} majuscule (\Emacron), tandis que 
\tex{Amacron} fera de même au-dessus d'un \quote{A} majuscule (\Amacron).
   
\stopitemize

Alors que les commandes de \in{table}[tbl:diacritics] fonctionnent avec les voyelles et certaines consonnes, il existe d'autres commandes pour générer certains diacritiques et lettres spéciales qui ne fonctionnent que sur une ou plusieurs lettres. Elles sont présentées dans \in{table} [tbl:morediacritics].

\PlaceMacro{aa}
\PlaceMacro{r}
\PlaceMacro{aring}
\PlaceMacro{o}
\PlaceMacro{l}
\PlaceMacro{ss}
\PlaceMacro{i}
\PlaceMacro{j}
\PlaceMacro{H}
\PlaceMacro{c}
\PlaceMacro{ccedilla}
\PlaceMacro{kcedilla}
\PlaceMacro{lcedilla}
\PlaceMacro{ncedilla}
\PlaceMacro{rcedilla}
\PlaceMacro{scedilla}
\PlaceMacro{tcedilla}

{\switchtobodyfont[small]
\placetable
  [here]
  [tbl:morediacritics]
  {\tfx More diacritics and special letters}
{\starttabulate[|l|l|l|l|]
\HL
\NC{\bf Nom}\NC{\bf Caractère}\NC{\bf Abréviation}\NC{\bf Commande}\NR
\HL
\NC O scandinave
\NC \o, \O
\NC \tex{o}, \tex{O}
\NC
\NR
\NC O scandinave
\NC \aring, \Aring, \r A
\NC \tex{aa}, \tex{AA}, \tex{r a}, \tex{r A}
\NC \tex{aring}, \tex{Aring}
\NR
\NC L polonais
\NC \l, \L
\NC \tex{l}, \tex{L}
\NC
\NR
\NC Eszett allemand
\NC \SS
\NC \tex{ss}, \tex{SS}
\NC
\NR
\NC \quote{i} et \quote{j} sans point
\NC \i, \j
\NC \tex{i}, \tex{j}
\NC
\NR
\NC Umlaut (ou tréma) hongrois,
\NC \H u, \H U
\NC \tex{H u}, \tex{H U}
\NC
\NR
\NC Cedilla
\NC \c c, \c C
\NC \tex{c c}, \tex{c C}
\NC \tex{ccedilla}, \tex{Ccedilla}
\NR
\HL
\stoptabulate}
}


Je tiens à préciser que certaines des commandes du tableau ci-dessus génèrent les caractères à partir d'autres caractères, tandis que d'autres commandes ne fonctionnent que si la police que nous utilisons a expressément prévu le caractère en question. Ainsi, en ce qui concerne l'Eszett allemand (ß), le tableau indique deux commandes mais un seul caractère, car la police que j'utilise ici pour ce texte ne prévoit que la version majuscule de l'eszett allemand (ce qui est assez courant). 

C'est probablement la raison pour laquelle je n'arrive pas non plus à obtenir le A scandinave en majuscules, bien que \MyKey{\{\backslash r A\}} et \cmd{Aring} fonctionnent correctement.

Le tréma hongrois fonctionne également avec la lettre \quote{o}, et la cédille avec les lettres \quote{k}, \quote{l}, \quote{n}, \quote{r}, \quote{s} et \quote{t}, respectivement en minuscule ou en majuscule. Les commandes à utiliser sont respectivement \cmd{kcedilla}, \cmd{lcedilla}, \cmd{ncedilla}...

\stopsubsection

% ***  SubSection ligatures

\startsubsection
  [
    reference=sec:ligatures,
    title={Ligatures traditionnelles},
  ]
  % There should be another section just for ligatures
  % automatically generated by ConTeXt as a font feature.
  % But in the end in the font chapter, I did not talk about
  % features of various fonts, and there was no where to
  % put this section.

Une ligature est formée par l'union de deux ou plusieurs graphèmes qui s'écrivent habituellement séparément. Cette \quotation{fusion} entre deux caractères a souvent commencé comme une sorte de sténographie dans les textes manuscrits, pour finalement atteindre une certaine indépendance typographique. Certains d'entre eux ont même été inclus parmi les caractères habituellement définis dans une police typographique, comme l'esperluette, \quote{\&}, qui a commencé comme une contraction de la copule (conjonction) latine \quotation{et}, ou l'Eszett (ß) allemand, qui, comme son nom l'indique, a commencé comme une combinaison d'un \quote{s} et d'un \quote{z}. Dans certaines polices de caractères, même aujourd'hui, nous pouvons retrouver les origines de ces deux caractères ; ou peut-être que je les vois parce que je sais qu'ils sont là. En particulier, avec la police Pagella pour \quote{\&} et avec Bookman pour \quote{ß}.

Comme exercice, je suggère (après avoir lu le \in{chapitre}[sec:fontscol], où il explique comment faire) d'essayer de représenter ces caractères avec ces polices à une taille suffisamment grande (par exemple, 30 pt) pour pouvoir travailler sur leurs composants.

D'autres ligatures traditionnelles qui ne sont pas devenues aussi populaires, mais qui sont encore utilisées occasionnellement aujourd'hui, sont les terminaisons latines \quotation{oe} et \quotation{ae} qui étaient parfois écrites comme \quote{\oe} ou \quote{ae} pour indiquer qu'elles formaient une diphtongue en latin. Ces ligatures peuvent être réalisées dans \ConTeXt\ avec les commandes trouvées dans \in{table}[tbl:ligatures]

\PlaceMacro{ae}
\PlaceMacro{aeligature}
\PlaceMacro{oe}
\PlaceMacro{oeligature}

\placetable
  [here]
  [tbl:ligatures]
  {Ligatures traditionnelles}
{
\starttabulate[|l|l|l|]
\HL
\NC {\bf Ligature}\NC {\bf Abréviation}\NC {\bf Commande}\NR
\HL
\NC \ae, \AE
\NC \tex{ae}, \tex{AE}
\NC \tex{aeligature}, \tex{AEligature}
\NR
\NC \oe, \OE
\NC \tex{oe}, \tex{OE}
\NC \tex{oeligature}, \tex{OEligature}
\NR
\HL
\stoptabulate}    

Une ligature qui était autrefois traditionnelle en espagnol (castillan) et que l'on ne trouve généralement pas dans les polices actuelles est \quote{Đ} : une contraction impliquant \quote{D} et \quote{E}. Pour autant que je sache, il n'y a pas de commande dans \ConTeXt\ qui nous permette de l'utiliser
,\footnote{Dans \LaTeX, par contre, nous pouvons utiliser la commande \cmd{DH} implémentée par le paquet \MyKey{fontenc}.}
mais nous pouvons en créer un, comme expliqué dans la section [sec:create characters].

En plus des ligatures précédentes, que j'ai appelées {\em traditionnelles} parce qu'elles proviennent de l'écriture manuscrite, après l'invention de la presse à imprimer, certaines ligatures de texte imprimé se sont développées, que j'appellerai \quotation{ligatures typographiques}, considérées par \ConTeXt\ comme des fonctionnalités de police et qui sont gérées automatiquement par le programme, bien que nous puissions influencer la façon dont ces fonctionnalités de police sont gérés (y compris les ligatures) avec \PlaceMacro{definefontfeature} \tex{definefontfeature} (voir \in{section}[sec:fontfeatures])


\stopsubsection

% ***  SubSection alphabet grec 

\startsubsection
  [title={Alphabet grec}]

Il est courant d'utiliser des caractères grecs dans les formules mathématiques et physiques. C'est pourquoi \ConTeXt\ a inclus la possibilité de générer tout l'alphabet grec, majuscules et minuscules. Ici, la commande est construite sur le nom anglais de la lettre grecque en question. Si le premier caractère est écrit en minuscule, nous aurons la lettre grecque en minuscule et s'il est écrit en majuscule, nous aurons la lettre grecque en majuscule. Par exemple, la commande \tex{mu} générera la version minuscule de cette lettre (\mu) tandis que \tex{Mu} générera la version majuscule (\Mu). Dans la \in{table}[tbl:greekletters], nous pouvons voir quelle commande génère chacune des lettres de l'alphabet grec, en minuscule et en majuscule.

{\smallbodyfont
\placetable
  [here,force]
  [tbl:greekletters]
  {Alphabet grec}
{
  \starttabulate[|l|l|l|]
    \HL
    \NC {\bf Nom}\NC {\bf Caractère (min/maj)}\NC {\bf Commande (lc/uc)}\NR
    \HL
    \NC Alpha\NC   \alpha, \Alpha\NC{\tt \backslash alpha, \backslash Alpha}\NR\PlaceMacro{alpha}
    \NC Bêta\NC    \beta,   \Beta\NC{\tt \backslash beta, \backslash Beta}\NR\PlaceMacro{beta}
    \NC Gamma\NC   \gamma, \Gamma\NC{\tt \backslash gamma, \backslash Gamma}\NR\PlaceMacro{gamma}
    \NC Delta\NC   \delta, \Delta\NC{\tt \backslash delta, \backslash Delta}\NR\PlaceMacro{delta}
    \NC Epsilon\NC \epsilon, \varepsilon, \Epsilon\NC{\tt \backslash epsilon, \backslash varepsilon, \backslash Epsilon}\NR\PlaceMacro{epsilon}\PlaceMacro{varepsilon}
    \NC Zêta\NC    \zeta, \Zeta\NC{\tt \backslash zeta, \backslash Zeta}\NR\PlaceMacro{zeta}
    \NC Êta\NC\eta, \Eta\NC{\tt \backslash eta, \backslash Eta}\NR\PlaceMacro{eta}
    \NC Thêta\NC\theta, \vartheta, \Theta\NC{\tt \backslash theta, \backslash vartheta, \backslash Theta}\NR\PlaceMacro{theta}\PlaceMacro{vartheta}
    \NC Iota\NC\iota, \Iota\NC{\tt \backslash iota, \backslash Iota}\NR\PlaceMacro{iota}
    \NC Kappa\NC\kappa, \varkappa, \Kappa\NC{\tt \backslash kappa, \backslash varkappa, \backslash Kappa}\NR\PlaceMacro{kappa}\PlaceMacro{varkappa}
    \NC Lambda\NC\lambda, \Lambda\NC{\tt \backslash lambda, \backslash Lambda}\NR\PlaceMacro{lambda}
    \NC Mu\NC\mu, \Mu\NC{\tt \backslash mu, \backslash Mu}\NR\PlaceMacro{mu}
    \NC Nu\NC\nu, \Nu\NC{\tt \backslash nu, \backslash Nu}\NR\PlaceMacro{nu}
    \NC Ksi ou Xi\NC\xi, \Xi\NC{\tt \backslash xi, \backslash Xi}\NR\PlaceMacro{xi}
    \NC Omicron\NC\omicron, \Omicron\NC{\tt \backslash omicron, \backslash Omicron}\NR\PlaceMacro{omicron}
    \NC Pi\NC\pi, \varpi, \Pi\NC{\tt \backslash pi, \backslash varpi, \backslash Pi}\NR\PlaceMacro{pi}\PlaceMacro{varpi}
    \NC Rhô\NC\rho, \varrho, \Rho\NC{\tt \backslash rho, \backslash varrho, \backslash Rho}\NR\PlaceMacro{rho}\PlaceMacro{varrho}
    \NC Sigma\NC\sigma, \varsigma, \Sigma\NC{\tt \backslash sigma, \backslash varsigma, \backslash Sigma}\NR\PlaceMacro{sigma}\PlaceMacro{varsigma}
    \NC Tau\NC\tau, \Tau\NC{\tt \backslash tau, \backslash Tau}\NR\PlaceMacro{tau}
    \NC Upsilon\NC\upsilon, \Upsilon\NC{\tt \backslash upsilon, \backslash Upsilon}\NR\PlaceMacro{upsilon}
    \NC Phi\NC\phi, \varphi, \Phi\NC{\tt \backslash phi, \backslash varphi, \backslash Phi}\NR\PlaceMacro{phi}\PlaceMacro{varphi}
    \NC Khi ou Chi\NC\chi, \Chi\NC{\tt \backslash chi, \backslash Chi}\NR\PlaceMacro{chi}
    \NC Psi\NC\psi, \Psi\NC{\tt \backslash psi, \backslash Psi}\NR\PlaceMacro{psi}
    \NC Oméga\NC\omega, \Omega\NC{\tt \backslash omega, \backslash Omega}\PlaceMacro{omega}\NR
    \HL
\stoptabulate}}

Notez que pour les versions minuscules de certains caractères (epsilon, kappa, theta, pi, rho, sigma et phi), il existe deux variantes possibles.

\stopsubsection

% ***  SubSection symboles

\startsubsection
  [title={Divers symboles}]

Outre les caractères que nous venons de voir, \TeX\ (et donc \ConTeXt\) propose des commandes permettant de générer un nombre quelconque de symboles. Ces commandes sont nombreuses. J'en ai fourni une liste étendue mais incomplète dans \in{appendix}[app:symbols].

\stopsubsection

% ***  SubSection créer un caractère

% TODO : garulfo peu approprié au débutant à mon avis

\startsubsection
  [
    reference=sec:create characters,
    title=Définir un caractère,
  ]
  \PlaceMacro{definecharacter}

Si nous devons utiliser des caractères qui ne sont pas accessibles depuis notre clavier, nous pouvons toujours trouver une page Web avec ces caractères et les copier dans notre fichier source. Si nous utilisons l'encodage UTF-8 (comme recommandé), cela fonctionnera presque toujours ({\bf si la police que vous utilisez les contient}, comme DejaVu qui les contient presque tous). Mais il existe également sur le wiki \ConTeXt\ \goto{une page contenant des tas de symboles}[url(wikisymbols)] qui peuvent être simplement copiés et collés dans notre document.

Toutefois, si nous devons utiliser plusieurs fois l'un des caractères en question, le copier-coller n'est pas le moyen le plus efficace d'y parvenir. Il serait préférable de définir le caractère de façon à ce qu'il soit associé à une commande qui le générera à chaque fois. Pour ce faire, on utilise \tex{definecharacter} dont la syntaxe est :

\placefigure [force,here,none] [] {}{
\startDemoI
\definecharacter {Nom} {Caractère}
\stopDemoI}

où

\startitemize

\item {\bf Nom} est le nom associé au nouveau caractère. Il ne doit pas s'agir du nom d'une commande existante, car cela écraserait cette commande.

\item {\bf Caractère} est le caractère généré chaque fois que nous exécutons \tex{Nom}. Il existe trois façons d'indiquer ce caractère :


  \startitemize

 \item en l'écrivant simplement ou en le collant dans notre fichier source (si nous l'avons copié d'un autre document électronique ou d'une page Web).

  \item en indiquant le numéro associé à ce caractère dans la police que nous utilisons actuellement. Pour voir les caractères inclus dans la police et les numéros qui leur sont associés, nous pouvons utiliser la commande \tex{showfont[{\em NomDePolice}]} (voir \in{section}[sec:see-font]).

  \item Construire le nouveau caractère avec l'une des commandes de construction de caractères composites que nous verrons immédiatement après.

  \stopitemize
  
\stopitemize

%TODO Garulfo avec LMTX https://wiki.contextgarden.net/composing_characters

Pour illustrer la première utilisation, revenons pour l'instant aux sections traitant des ligatures (\in{}[sec:ligatures]). J'y ai parlé d'une ligature traditionnelle en espagnol que l'on ne trouve généralement pas dans les polices actuelles : \quote{Đ}. Nous pourrions associer ce caractère, par exemple, à la commande \tex{decontract} afin que le caractère soit généré chaque fois que nous écrivons \tex{decontract}. Nous faisons cela avec :

\placefigure [force,here,none] [] {}{
\startDemoVN
\definecharacter {decontract} {Đ}
Ce caractère~: {\tfd \decontract}.
\stopDemoVN}


\startSmallPrint

Pour construire un nouveau caractère qui n'est pas dans notre police, et qui ne peut pas être obtenu à partir du clavier, comme c'est le cas de l'exemple que je viens de donner, il faut d'abord trouver un texte où ce caractère se trouve, le copier et être capable de le coller dans notre définition. Dans l'exemple que je viens de donner, j'ai initialement copié la \quote{Đ} de Wikipedia.
  
\stopSmallPrint

\ConTeXt\ comprend également certaines commandes qui nous permettent de créer des caractères composites et qui peuvent être utilisées en combinaison avec \tex{definecharacter}. Par caractères composites, j'entends les caractères qui possèdent également des diacritiques. Les commandes sont les suivantes~:


\PlaceMacro{buildmathaccent}\PlaceMacro{buildtextaccent}\PlaceMacro{buildtextbootomcomma}\PlaceMacro{buildtextbottomdot}\PlaceMacro{buildtextcedilla}\PlaceMacro{buildtextgrave}\PlaceMacro{buildtextmacron}\PlaceMacro{buildtexttognek}

\placefigure [force,here,none] [] {}{
\startDemoVW
\definecharacter zete     {\buildtextaccent ` z}
\definecharacter zcomma   {\buildtextbottomcomma z}
\definecharacter zdot     {\buildtextbottomdot z}
\definecharacter zcedilla {\buildtextcedilla z}
\definecharacter zgrave   {\buildtextgrave z}
\definecharacter zmacron  {\buildtextmacron z}

zete      ~,~ zcomma  ~,~ zdot    ~,~ 
zcedilla  ~,~ zgrave  ~,~ zmacron
\stopDemoVW}

Par exemple : comme nous le savons déjà, par défaut, \ConTeXt\ ne possède que des commandes pour écrire certaines lettres avec une cédille (c, k, l, n, r, s y t) qui sont généralement incorporées dans les polices de caractères. Si nous voulions utiliser un \quotation{b}, nous pourrions utiliser la commande \cmd{buildtextcedilla} comme dans l'exemple.

Cette commande crée la nouvelle commande \tex{bB} qui générera un \quotation{b} avec une cédille. Ces commandes construisent littéralement le nouveau caractère qui sera généré même si notre police ne le possède pas. Ce que font ces commandes, c'est superposer un caractère sur un autre, puis donner un nom à cette superposition.

\startSmallPrint

  Lors de mes tests, je n'ai pas réussi à faire fonctionner \tex{buildmathaccent} ou \tex{buildtextognek}. Je ne les mentionnerai donc plus à partir de maintenant.
  
\stopSmallPrint

\tex{buildtextaccent} prend deux caractères comme arguments et en superpose un sur l'autre, en relevant légèrement l'un d'eux. Bien qu'elle soit appelée \quotation{buildtextaccent}, il n'est pas essentiel que l'un des caractères pris comme arguments soit un accent ; mais la superposition donnera de meilleurs résultats s'il l'est, car dans ce cas, en superposant l'accent sur le caractère, l'accent a moins de chances d'écraser le caractère. D'autre part, le chevauchement de deux caractères qui ont la même ligne de base dans des conditions normales est affecté par le fait que la commande élève légèrement l'un des caractères au-dessus de l'autre. C'est pourquoi nous ne pouvons pas utiliser cette commande, par exemple, pour obtenir la contraction \quote{Đ} mentionnée plus haut, car si nous écrivons~:

\placefigure [force,here,none] [] {}{
\startDemoVN
\definecharacter {decontract} {\buildtextaccent D E} 
\decontract ~ vs ~ Đ
\stopDemoVN}

dans notre fichier source, la légère élévation au-dessus de la ligne de base de \quote{D} que cette commande produit n'est pas très bon. Mais si la hauteur des caractères le permet, nous pourrions créer une combinaison. Par exemple~:

\placefigure [force,here,none] [] {}{
\startDemoVN
\definecharacter unusual {\buildtextaccent \_ "}
regarde~: \unusual
\stopDemoVN}

Le reste des commandes de construction prend un seul argument -- le caractère auquel le diacritique généré par chaque commande sera ajouté. L'exemple ci-dessus montre un exemple de chacune d'entre elles, construite sur la lettre \quote{z} :



\startitemize

\item \tex{buildtextbottomcomma} ajoute une virgule sous le caractère qu'il prend comme argument.
\item \tex{buildtextbottomdot} ajoute un point sous le caractère qu'il prend comme argument.
\item \tex{buildtextcedilla} ajoute une cédille sous le caractère qu'il prend comme argument.
\item \tex{buildtextgrave} ajoute un accent grave sur le caractère qu'il prend comme argument.
\item \tex{buildtextmacron} ajoute une petite barre sous le caractère qu'il prend comme argument.
  
\stopitemize

À première vue, \tex{buildtextgrave} semble redondant étant donné que nous avons \tex{buildtextaccent} ; Cependant, si vous vérifiez l'accent grave généré par la première de ces deux commandes, il semble un peu mieux. L'exemple suivant montre le résultat des deux commandes, à une taille de police suffisante pour apprécier la différence :

\placefigure [force,here,none] [] {}{
\startDemoVW
\definecharacter zgrave  {\buildtextgrave z}
\definecharacter zgraveb {\buildtextaccent ` z}
\switchtobodyfont[30pt]
\midaligned{\framed{\zgrave\ -- \zgraveb}}
\stopDemoVW}



\stopsubsection

% ***  SubSection utiliser des symboles

\startsubsection
  [title={Utilisation de jeux de symboles prédéfinis}]

\suite- comprend, en plus de \ConTeXt\, un certain nombre de jeux de symboles prédéfinis que nous pouvons utiliser dans nos documents. Ces ensembles sont appelés \MyKey{cc}, \MyKey{cow}, \MyKey{fontawesome}, \MyKey{jmn}, \MyKey{mvs} et \MyKey{nav}. Chacun de ces ensembles comprend également des sous-ensembles :


\startitemize[packed]

\item {\tt\bf cc} comprends \quotation{\tt cc}.

\item {\tt\bf cow} comprends \quotation{\tt cownormal} et \quotation{\tt cowcontour}.

\item {\tt\bf fontawesome} comprends \quotation{\tt fontawesome-regular}, \quotation{\tt fontawesome-solid} et \quotation{\tt fontawesome-brands}.

\item {\tt\bf jmn} comprends \quotation{\tt navigation~1}, \quotation{\tt navigation~2},  \quotation{\tt navigation~3} et \quotation{\tt navigation~4}.

\item {\tt\bf mvs} comprends \quotation{\tt astronomic}, \quotation{\tt zodiac}, \quotation{\tt europe}, \quotation{\tt martinvogel~1}, \quotation{\tt martinvogel~2} et \quotation{\tt martinvogel~3}.

\item {\tt\bf nav} comprends \quotation{\tt navigation~1}, \quotation{\tt navigation~2} et \quotation{\tt navigation~3}.
  
\stopitemize


\startSmallPrint

  Le wiki mentionne également un ensemble appelé {\tt\bf was} qui inclut \quotation{wasy general}, \quotation{wasy music}, \quotation{wasy astronomy}, \quotation{wasy astrology}, \quotation{wasy geometry}, \quotation{wasy physics} et \quotation{wasy apl}. Mais je n'ai pas pu les trouver dans ma distribution, et mes tests pour tenter d'y accéder ont échoué.

  
\stopSmallPrint

Pour voir les symboles spécifiques contenus dans chacun de ces ensembles, on utilise les commandes \tex{usesymbols} \tex{showsymbolset}. Par exemple : si nous voulons voir les symboles inclus dans \quotation{\tt mvs/zodiac}, alors dans le fichier source nous devons écrire :

\PlaceMacro{usesymbols} \PlaceMacro{showsymbolset}

\placefigure [force,here,none] [] {}{
\startDemoVN
\usesymbols [mvs]
\showsymbolset[zodiac]
\stopDemoVN}

Notez que le nom de chaque symbole est indiqué ainsi que le symbole. La commande \PlaceMacro{symbol}\tex{symbol} nous permet alors d'utiliser n'importe lequel des symboles. Par exemple, si nous voulons utiliser le symbole astrologique associé au Verseau (trouvé dans mvs/zodiac), nous devons écrire~:

\placefigure [force,here,none] [] {}{
\startDemoVN
\usesymbols [mvs]
\symbol[zodiac][Aquarius]
\stopDemoVN}

Le symbole est traité comme un \quotation{caractère} et sera donc affectée par la taille de police active lors de l'impression. Nous pouvons également utiliser \tex{definecharacter} pour associer le symbole en question à une commande. Par exemple et utiliser ces symboles, par exemple, dans un environnement d'énumération. Par exemple~:

\placefigure [force,here,none] [] {}{
\startDemoVW
\usesymbols[mvs] 
\definecharacter %
  SymbAries  \symbol[zodiac][Aquarius]
\definesymbol [1]
  [{\symbol[martinvogel 2][PointingHand]}]
\definesymbol [2]
  [{\symbol[martinvogel 2][CheckedBox]}]

\startitemize[packed]
  \item item avec \SymbAries
  \item item 
  \startitemize[packed]
    \item item 
    \item item
  \stopitemize
  \item item
\stopitemize
\stopDemoVW}

\stopsubsection

\stopsection

% **   Section    formatages spéciaux des caractères

\startsection
  [title={Formatages spéciaux des caractères}]

À proprement parler, ce sont les commandes de {\em formatage} qui affectent la police utilisée, sa taille, son style ou sa variante. Ces commandes sont expliquées dans le \in{Chapitre} [sec:fontscol]. Cependant, d'un point de vue plus {\em général}, nous pouvons également considérer les commandes qui modifient d'une manière ou d'une autre les caractères qu'elles prennent comme argument (modifiant ainsi leur apparence) comme des commandes de formatage du texte. Nous allons examiner certaines de ces commandes dans cette section. D'autres, telles que le texte souligné ou aligné avec des lignes au-dessus ou au-dessous du texte courant (par exemple, lorsque nous voulons fournir de l'espace pour répondre à une question) seront vues dans \in{section}[sec:FramesLines].

% ***  SubSection majuscules, minuscules et fausses petites majuscules

\startsubsection
  [
    reference=sec:Upper-Lower-Fake,
    title={Majuscules, minuscules et fausses petites majuscules},
  ]

Les lettres elles-mêmes peuvent être en majuscules ou en minuscules. Pour \ConTeXt, les majuscules et les minuscules sont des caractères différents, donc en principe il composera les lettres comme il les trouve écrites. Cependant, il existe un groupe de commandes qui nous permettent de nous assurer que le texte qu'elles prennent comme argument est toujours écrit en majuscules ou en minuscules~:

\startitemize[packed]

\item \PlaceMacro{word} \cmd{word\{texte\}} : convertit le texte pris comme argument en minuscules.
  
\item \PlaceMacro{Word} \cmd{Word\{texte\}} : convertit en majuscule la première lettre du texte pris en argument.
  
\item \PlaceMacro{Words} \cmd{Words\{texte\}} : convertit en majuscule la première lettre de chacun des mots pris comme argument ; les autres sont en minuscule.
  
\item \PlaceMacro{WORD} \cmd{WORD\{texte\}} ou \PlaceMacro{WORDS} \cmd{WORD\{texte\}} : écrit le texte pris comme argument en majuscules.
 
\stopitemize

\placefigure [force,here,none] [] {}{
\startDemoVN
\word        {ceCi esT UN tESt} \\
\Word        {ceCi esT UN tESt} \\
\Words       {ceCi esT UN tESt} \\
\WORD        {ceCi esT UN tESt} \\
\WORDS       {ceCi esT UN tESt} \\
\Word{\word  {ceCi esT UN tESt}}
\stopDemoVN}

Les commandes \PlaceMacro{cap} \tex{cap} et \PlaceMacro{Cap} \tex{Cap} sont très similaires à celles-ci~: elles mettent également en majuscules le texte qu'elles prennent comme argument, mais lui appliquent ensuite un facteur d'échelle égal à celui appliqué par le suffixe \quote{x} dans les commandes de changement de police (voir \in{section}[sec:quick-change]) de sorte que, dans la plupart des polices, les majuscules auront la même hauteur que les minuscules, ce qui nous donne une sorte d'effet de fausses petites capitales. Par rapport aux vraies petites capitales (voir \in{section}[sec:smallcaps]), celles-ci présentent les avantages suivants :



\startitemize[n]

item \tex{cap} et \tex{Cap} fonctionnent avec n'importe quelle police, contrairement aux vraies petites capitales qui ne fonctionnent qu'avec les polices et les styles qui les incluent expressément.

\item Les vraies petites capitales, quant à elles, sont une variante de la police qui, en tant que telle, est incompatible avec toute autre variante telle que le gras, l'italique ou l'incliné. En revanche, \tex{cap} et \tex{Cap} sont entièrement compatibles avec toutes les variantes de police.
  
\stopitemize

La différence entre \cmd{cap} et \cmd{Cap} est que, tandis que le premier applique le facteur d'échelle à toutes les lettres des mots qui composent son argument, \cmd{Cap} n'applique aucune échelle à la première lettre de chaque mot, obtenant ainsi un effet similaire à celui que l'on obtient si l'on utilise de vraies majuscules dans un texte en petites capitales. Si le texte pris comme argument dans \quote{caps} est constitué de plusieurs mots, la taille de la majuscule de la première lettre de chaque mot sera maintenue.

% TODO Garulfo bug ici avec \Cap... Qui ontroduit : ⋒...

\placefigure [force,here,none] [] {}{
\startDemoVN
L'ONU, dont le \Cap{président} a son bureau au siège de l'\cap{oNu}...
\stopDemoVN}

Il faut noter, tout d'abord, la différence de taille entre la première fois que nous écrivons \quotation{ONU} (en majuscules) et la deuxième fois (en petites capitales, \quotation{\cap{oNu}}). Dans l'exemple, j'ai écrit \cmd{cap\{oNu\}} la deuxième fois pour que nous puissions voir que cela n'a pas d'importance si nous écrivons l'argument que prend \cmd{cap} en majuscules ou en minuscules : la commande convertit toutes les lettres en majuscules et applique ensuite un facteur de mise à l'échelle, contrairement à \cmd{Cap} qui ne met pas à l'échelle la première lettre.

Ces commandes peuvent également être {\em imbriquées}, auquel cas le facteur d'échelle est appliqué une fois de plus, ce qui entraîne une réduction supplémentaire, comme dans l'exemple suivant où le mot \quotation{capital} de la première ligne est encore réduit :

\placefigure [force,here,none] [] {}{
\startDemoVN
Les Personnes, \cap{Les personnes qui ont amassé leur \cap{capital} au détriment des autres sont le plus souvent {\bf décapitées} en période de révolution}.
\stopDemoVN}


La commande \tex{nocap} appliquée à un texte auquel est appliqué \tex{cap}, annule l'effet de \tex{cap} dans le texte qui est son argument. Par exemple :

\placefigure [force,here,none] [] {}{
\startDemoVN

\cap{Quand j'étais un, je venais de commencer, quand j'étais deux, j'étais \nocap{presque} nouveau (A.A. Milne)}.
\stopDemoVN}

Nous pouvons configurer le fonctionnement de \cmd{cap} avec \PlaceMacro{setupcapitals} \cmd{setupcapitals} et nous pouvons également définir différentes versions de la commande, chacune avec son propre nom et sa configuration spécifique. Nous pouvons le faire avec \PlaceMacro{definecapitals} \cmd{definecapitals}.

Les deux commandes fonctionnent de manière similaire~:


\placefigure [force,here,none] [] {}{
\startDemoI
\definecapitals [Nom] [Configuration]
\setupcapitals  [Nom] [Configuration]
\stopDemoI}

Le paramètre \quotation{Nom} de la commande \cmd{setupcapitals} est facultatif. S'il n'est pas utilisé, la configuration affectera la commande \cmd{cap} elle-même. S'il est utilisé, nous devons donner le nom que nous avons précédemment attribué dans \cmd{definecapitals} à une configuration réelle.

Dans l'une ou l'autre des deux commandes, la configuration permet trois options~: \quotation{\tt title}, \quotation{\tt sc} et \quotation{\tt style}, la première et la seconde autorisant \quotation{yes} et \quotation{no} comme valeurs. Avec \quotation{\tt title}, nous indiquons si la capitalisation affectera également les titres (ce qui est le cas par défaut) et avec \quotation{\tt sc}, nous indiquons si la commande doit utiliser de véritables petites capitales (\quotation{yes}) ou de fausses petites capitales (\quotation{no}). Par défaut, il utilise les fausses petites capitales, ce qui présente l'avantage que la commande fonctionne même si vous utilisez une police qui n'a pas implémenté les petites capitales. La troisième valeur \quotation{{\tt style}} permet d'indiquer une commande de style à appliquer au texte affecté par la commande \cmd{cap}.

\stopsubsection

% ***  SubSection texte en exposant ou en indice

\startsubsection
  [title={Texte en exposant ou en indice}]

Nous savons déjà (voir \in{section}[sec:reserved characters]) que dans le mode maths, les caractères réservés \MyKey{_} et \MyKey{^} convertiront le caractère ou le groupe qui suit immédiatement en exposant ou en indice. Pour obtenir cet effet en dehors du mode mathématique, \ConTeXt\ comprend les commandes suivantes~:

\PlaceMacro{high}  \PlaceMacro{low} \PlaceMacro{lohi}

\startitemize

\item \cmd{high\{Texte\}} : écrit le texte qu'il prend comme argument en exposant.

\item \cmd{low\{Texte\}} : écrit le texte qu'elle prend comme argument en indice.

\item \cmd{lohi\{texte 1\}\{Texte 2\}} : écrit les deux arguments l'un au-dessus de l'autre : en bas le premier argument, et en haut le second.

\stopitemize

\placefigure [force,here,none] [] {}{
\startDemoVN
Ceci est un texte \high{en haut}, un autre \low{en bas}, et une combinaison \lohi{en bas}{en haut}
\stopDemoVN}

\stopsubsection

% ***  SubSection test en verbatim

\startsubsection
  [
    reference=sec:verbatim,
    title={Texte en verbatim},
  ]
  \PlaceMacro{type} \PlaceMacro{starttyping}

 L'expression latine {\em verbatim} (de {\em verbum} $=$ {\em mot} avec le suffixe {\em atim}), qui pourrait être traduite par \quotation{littéral} ou \quotation{mot pour mot}, est utilisée dans les programmes de traitement de texte comme \ConTeXt\ pour désigner les fragments de texte qui ne doivent pas être transformé ni mis en forme,  ils doivent être affichés, tels quels, dans le fichier final. Pour cela, \ConTeXt\ utilise la commande \tex{type}, destinée aux textes courts qui n'occupent pas plus d'une ligne et l'environnement {\tt typing} destiné aux textes de plus d'une ligne. Ces commandes sont largement utilisées dans les livres d'informatique pour afficher les fragments de code, et \ConTeXt\ met en forme ces textes en lettres monospace comme le ferait une machine à écrire ou un terminal d'ordinateur. Dans les deux cas, le texte est envoyé dans le document final sans {\em traitement}, ce qui signifie qu'il peut utiliser des caractères réservés ou des caractères spéciaux qui seront transcrits {\em tel quel} dans le fichier final. De même, si l'argument de \tex{type}, ou le contenu de \tex{starttyping} comprend une commande, celle-ci sera {\em écrite} dans le document final, mais pas exécutée.

La commande \tex{type} présente, en outre, la particularité suivante : son argument {\em peut} être contenu entre des crochets (comme c'est normal dans \ConTeXt), mais tout autre caractère peut être utilisé pour délimiter (entourer) l'argument.


\startSmallPrint

Lorsque \ConTeXt\ lit la commande \tex{type}, il suppose que le caractère qui n'est pas un espace blanc suivant immédiatement le nom de la commande agira comme un délimiteur de son argument ; il considère donc que le contenu de l'argument commence par le caractère suivant, et se termine par le caractère précédant la prochaine apparition du {\em délimiteur}.

Quelques exemples nous aideront à mieux comprendre :

\placefigure [force,here,none] [] {}{
\startDemoVW
\type 1Tweedledum and Tweedledee A1 \\
\type µTweedledum and Tweedledee Bµ \\ 
\type zTweedledum and Tweedledee Cz \\
\type (Tweedledum and Tweedledee D( \\
\stopDemoVW}


Notez que dans le premier exemple, le premier caractère après le nom de la commande est un \quote{1}, dans le deuxième un \quote{\|} et dans le troisième un \quote{z} ; ainsi : dans chacun de ces cas, \ConTeXt\ considérera que l'argument de \tex{type} est tout ce qui se trouve entre ce caractère et la prochaine apparition du même caractère. Il en va de même pour le dernier exemple, qui est également très instructif, car en principe, on pourrait supposer que si le délimiteur d'ouverture de l'argument est un \quote{(}, celui de fermeture devrait être un \quote{)}, mais ce n'est pas le cas, car \quote{(} et \quote{)} sont des caractères différents et \tex{type}, comme je l'ai dit, recherche un délimiteur de fermeture identique au caractère utilisé au début de l'argument.

Il n'y a que deux cas où \tex{type} permet que les délimiteurs d'ouverture et de fermeture soient des caractères différents :



\startitemize

\item Si le délimiteur d'ouverture est le caractère \quote{\{}, il pense que le délimiteur de fermeture sera \quote{\}}.

\item Si le délimiteur d'ouverture est le caractère \quote{<<}, il pense que le délimiteur de fermeture sera \quote{>>}. Ce cas est également unique dans la mesure où deux caractères consécutifs sont utilisés comme délimiteurs.

\stopitemize

 Toutefois, le fait que \tex{type} autorise n'importe quel délimiteur ne signifie pas que nous devrions utiliser des délimiteurs \quotation{bizarre}. Du point de vue de la lisibilité et de l'intelligibilité du fichier source, il est préférable de délimiter l'argument du \tex{type} par des accolades lorsque cela est possible, comme c'est le cas avec \ConTeXt\ ; et lorsque cela n'est pas possible, parce qu'il y a des accolades dans l'argument du \tex{type}, utilisez un symbole~: de préférence un qui ne soit pas un caractère réservé \ConTeXt\. Par exemple~: \cmd{type *Ceci est une accolade fermante :    \quote{\}}*}.


\stopSmallPrint

\tex{type} et \tex{starttyping} peuvent être configurés avec \PlaceMacro{setuptype} \tex{setuptype} et \PlaceMacro{setuptyping} \tex{setuptyping}. Nous pouvons également créer une version personnalisée de ces éléments avec \PlaceMacro{definetype} \tex{definetype} et \PlaceMacro{definetyping} \tex{definetyping}. En ce qui concerne les options de configuration réelles de ces commandes, je me réfère à \MyKey{setup-fr.pdf} (dans le répertoire {\tt tex/texmf-context/doc/context/documents/general/qrcs}).


Deux commandes très similaires à \tex{type} sont :

\startitemize

\item \PlaceMacro{typ} \tex{typ} : fonctionne de manière similaire à \tex{type}, mais ne désactive pas les césures.

\item \PlaceMacro{tex}\tex{tex} : commande destinée à la rédaction de textes sur \TeX\ ou \ConTeXt\ : elle ajoute une barre oblique inversée (backslash ou antislash) devant le texte qu'elle prend comme argument. Sinon, cette commande diffère de \tex{type} en ce qu'elle traite certains des caractères réservés qu'elle trouve dans le texte qu'elle prend comme argument. En particulier, les crochets à l'intérieur de \tex{tex} seront traités de la même manière qu'ils le sont habituellement dans \ConTeXt.

\stopitemize

\stopsubsection

\stopsection

% **   Section    espacement des caractères et des mots

\startsection
  [
    reference=sec:horizontal space1,
    title={Espacement des caractères et des mots},
  ]

% ***  SubSection réglage automatique de l'espacement horizontal

\startsubsection
  [title=Réglage automatique de l'espacement horizontal]

L'espace entre les différents caractères et mots (appelé {\em espace horizontal} dans \TeX) est défini automatiquement par \ConTeXt :

\startitemize

\item L'espace entre les caractères qui composent un mot est défini par la police elle-même, qui, sauf dans les polices à largeur fixe, utilise généralement une quantité plus ou moins grande d'espace blanc en fonction des caractères à séparer, et donc, par exemple, l'espace entre un \quote{A} et un \quote{V} (\quote{AV}) est généralement moins grand que l'espace entre un \quote{A} et un \quote{X} (\quote{AX}). Cependant, en dehors de ces variations possibles qui dépendent de la combinaison de lettres concernées et prédéfinies par la police de caractères, l'espace entre les caractères qui composent un mot est, en général, une mesure fixe et invariable (que \ConTeXt\ peut parfois adapter, mécanisme appelé {\em expansion} et configuré avec \tex{definefontfeature} et \tex{setupalign}).

% TODO Garulfo : ici rajouter lien ave csetualign et definefontfeature

\placefigure [force,here,none] [] {}{
\startDemoVN%
\switchtobodyfont[50pt]%
AVA \\
AXA
\stopDemoVN}

\item En revanche, l'espace entre les mots d'une même ligne peut être plus élastique.


  \startitemize

\item Dans le cas des mots d'une ligne dont la largeur doit être la même que celle du reste des lignes du paragraphe, la variation de l'espacement entre les mots est l'un des mécanismes que \ConTeXt\ utilise pour obtenir des lignes de largeur égale, comme expliqué plus en détail dans \in{section}[sec:lines]. Dans ces cas, \ConTeXt\ établira exactement le même espace horizontal entre tous les mots de la ligne (sauf pour les règles ci-dessous), tout en s'assurant que l'espace entre les mots des différentes lignes du paragraphe est aussi similaire que possible.

  \item Cependant, en plus de la nécessité d'étirer ou de rétrécir l'espacement entre les mots afin de justifier les lignes, selon la langue active, \ConTeXt\ prend en considération certaines règles typographiques selon lesquelles, à certains endroits, la tradition typographique associée à cette langue ajoute un espace blanc supplémentaire, comme c'est le cas, par exemple, dans certaines parties de la tradition typographique anglaise, qui ajoute un espace blanc supplémentaire après un point.

% TODO Garulfo trouver un test 

    \startSmallPrint

Ces espaces blancs supplémentaires fonctionnent pour l'anglais et peut-être pour d'autres langues (bien qu'il soit également vrai que dans de nombreux cas, les éditeurs anglais choisissent aujourd'hui de ne pas avoir d'espace supplémentaire après un point) mais pas toujours pour le français où la tradition typographique est différente. Nous pouvons donc activer temporairement cette fonction avec \PlaceMacro{setupspacing} \cmd{setupspacing[broad]} et la désactiver avec \cmd{setupspacing[packed]}. Nous pouvons également modifier la configuration par défaut pour le français avec \tex{setcharacterspacing [frenchpunctuation]} (et d'ailleurs pour toute autre langue, y compris l'anglais), comme expliqué dans \in{section}[sec:langconfig].

    \stopSmallPrint

  \stopitemize

\stopitemize

\stopsubsection

% ***  SubSection modification de l'espacement entre les caractères d'un mot


% TODO : Garulfo  pas si simple que ça streched joue sur l'ensemble des espacements...
% https://articles.contextgarden.net/journal/2017/27-76.pdf

\startsubsection
  [title=Modification de l'espace entre les caractères et les mots]


Modifier l'espace par défaut des caractères qui composent un mot est considéré comme une très mauvaise pratique d'un point de vue typographique, sauf dans les titres et les en-têtes. \ConTeXt\ fournit une commande pour modifier cet espace entre les caractères d'un mot~: \footnote{Il est typique de la philosophie de \ConTeXt\ d'inclure une commande pour faire quelque chose que la documentation \ConTeXt\ elle-même déconseille de faire. Bien que la perfection typographique soit recherchée, l'objectif est également de donner à l'auteur un contrôle absolu sur l'apparence de son document : qu'il soit meilleur ou moins bon est, en somme, de sa responsabilité.} \PlaceMacro{stretched} \tex{stretched}, dont la syntaxe est la suivante :

\placefigure [force,here,none] [] {}{
\startDemoI
\stretched[Configuration]{Texte}
\stopDemoI}



où {\em Configuration} permet l'une des options suivantes~:

\startitemize

\item {\tt factor} : un nombre décimal qui influence la répartition de l'espace additionnel entre les mots et entre les lettres.

\item {\tt width} : indique la largeur totale que doit avoir le texte soumis à la commande, de telle sorte que la commande calcule elle-même l'espacement nécessaire pour répartir les caractères dans cet espace. Par défaut, l'espacement horizontal ajouté comblera la longeur disponible sur la ligne pour le texte donné en argument. Si {\tt factor} devient trop important, alors \ConTeXt continuera de faire grandir les espaces sans respecter la valeur de largeur {\tt width} indiquée.

  \startSmallPrint

D'après mes tests, lorsque la largeur établie avec l'option {\tt width} est inférieure à celle requise pour représenter le texte avec un {\em factor} égal à $0.25$, l'option {\tt width} et ce facteur sont ignorés. Je suppose que c'est parce que \cmd{stretched} ne nous permet que d'augmenter l'espace entre les caractères d'un mot, et non de le réduire. Mais je ne comprends pas pourquoi la largeur requise pour représenter le texte avec un facteur de 0,25 est utilisée comme mesure minimale pour l'option {\tt width}, et non la {\em natural width} du texte (avec un facteur de 0).

  \stopSmallPrint

\item {\tt\bf style} : la ou les commandes de style à appliquer au texte pris en argument.

\item {\tt\bf color} : couleur dans laquelle le texte pris comme argument sera écrit.

\stopitemize

Ainsi, dans l'exemple suivant, nous pouvons voir graphiquement comment la commande fonctionnerait lorsqu'elle est appliquée à la même phrase, mais avec des largeurs différentes :

\placefigure [force,here,none] [] {}{
\startDemoHN
%\setupcharacterkerning
%  [stretched]
%  [factor=max,
%   width=\availablehsize]
                                    {\bfd to the limit}\\
\stretched[factor=0.00,  width=10cm]{\bfd to the limit}\\
\stretched[factor=0.25,  width=10cm]{\bfd to the limit}\\
\stretched[factor=0.50,  width=10cm]{\bfd to the limit}\\
\stretched[factor=0.75,  width=10cm]{\bfd to the limit}\\
\stretched[factor=1.00,  width=10cm]{\bfd to the limit}\\
\stretched[factor=1.25,  width=10cm]{\bfd to the limit}\\
\stretched[factor=1.50,  width=10cm]{\bfd to the limit}\\
\stretched[factor=1.75,  width=10cm]{\bfd to the limit}\\
\\
\stretched[factor=max,   width=10cm]{\bfd to the limit}\\ 
\\
\stretched[factor=0.75,  width=10cm]{\bfd to the limit}\\
\stretched[factor=0.80,  width=10cm]{\bfd to the limit}\\
\stretched[factor=0.85,  width=10cm]{\bfd to the limit}\\
\\
\stretched[factor=0.75]             {\bfd to the limit}
\stopDemoHN}


\startSmallPrint

Dans cet exemple, en l'absenc de {\tt factor}, on peut voir que la répartition de l'espace horizontal entre les différents caractères n'est pas uniforme. Les \quote{T} et \quote{e} dans \quotation{Texte} apparaissent toujours beaucoup plus proches les uns des autres que les autres caractères. Je n'ai pas réussi à trouver la raison de ce phénomène.
  
\stopSmallPrint

Appliquée sans argument, la commande utilisera toute la largeur de la ligne. Par contre, dans le texte qui est l'argument de cette commande, la commande \cmd{\backslash} est redéfinie et au lieu d'un saut de ligne, elle insère un espace horizontal. Par exemple~:

\placefigure [force,here,none] [] {}{
\startDemoHN
\stretched[width=8cm,factor=0.25] {Texte de    test G}\\
\stretched[width=8cm,factor=0.25] {Texte de \\ test G}
\stopDemoHN}

Nous pouvons personnaliser la configuration par défaut de la commande avec
\PlaceMacro{setupstretched} \cmd{setupstretched}.



\startSmallPrint

Il n'existe pas de commande \PlaceMacro{definestretched} \cmd{definestretched} qui nous permettrait de définir des configurations personnalisées associées à un nom de commande \Doubt, cependant, dans la liste officielle des commandes (voir \in{section}[sec:qrc-setup-en]), il est indiqué que \cmd{setupstretched} provient de \PlaceMacro{setupcharacterkerning} \tex{setupcharacterkerning} et qu'il existe une commande \PlaceMacro{definecharacterkerning} \cmd{de\-fi\-ne\-cha\-rac\-ter\-ker\-ning}. Dans mes tests, cependant, je n'ai pas réussi à définir une configuration personnalisée pour \cmd{stretched} au moyen de cette dernière, bien que je doive admettre que je n'ai pas passé beaucoup de temps à essayer de le faire non plus.

\stopSmallPrint

\stopsubsection

% ***  SubSection ajouter un espace horizontal entre les mots

\startsubsection
  [
    reference=sec:horizontal space2,
    title={Commandes pour ajouter un espace horizontal entre les mots},
  ]

Nous savons déjà que pour augmenter l'espace entre les mots, il est inutile d'ajouter deux espaces vides consécutifs ou plus, car \ConTeXt\ absorbe tous les espaces vides consécutifs, comme expliqué dans \in{section}[sec:spaces]. Si nous souhaitons augmenter l'espace entre les mots, nous devons passer par l'une des commandes qui nous permet de le faire :



\startitemize

\item \cmd{,} insère un très petit espace vide (appelé espace mince) dans le document. Il est utilisé, par exemple, pour séparer les milliers dans un ensemble de chiffres (par exemple 1,000,000), ou pour séparer une simple virgule inversée des doubles virgules inversées. Par exemple :

\placefigure [force,here,none] [] {}{
\startDemoVN
1 473 451   \\
1\,473\,451 \\
\stopDemoVN}


\item \PlaceMacro{\textvisiblespace} \PlaceMacro{space} \cmd{space} ou \quotation{\cmd{\textvisiblespace}} (une barre oblique inversée suivie d'un espace vide que j'ai représenté par \quotation{\textvisiblespace}, car il s'agit d'un caractère invisible) introduit un espace vide supplémentaire.

% TODO garulfo la taille se réfère à em ou xheight, plutôt x non ?

\item \PlaceMacro{enskip}\cmd{enskip}, \PlaceMacro{quad}\cmd{quad} et \PlaceMacro{qquad}\cmd{qquad} insèrent un espace blanc dans le document de respectivement un demi-{\em em}, 1{\em em} ou 2{\em ems}. N'oubliez pas que le {\em em} est une mesure qui dépend de la taille de la police et équivaut à la largeur d'un \quote{m}, qui coïncide normalement avec la taille en points de la police. Ainsi, en utilisant une police de 12 points, \cmd{enskip} nous donne un espace de 6 points, \cmd{quad} nous donne 12 points et \cmd{qquad} nous donne 24 points.

\stopitemize


Outre ces commandes qui nous donnent des espaces vides de dimensions précises, les commandes \PlaceMacro{hskip}\cmd{hskip} et \PlaceMacro{hfill}\cmd{hfill} introduisent des espaces horizontaux de dimensions variables :

\PlaceMacro{hskip}\cmd{hskip} nous permet d'indiquer exactement la quantité d'espace vide que nous voulons ajouter. L'espace indiqué peut être négatif, ce qui entraînera la superposition d'un texte sur un autre. Ainsi~:


\placefigure [force,here,none] [] {}{
\startDemoHN
Ceci est un espace de \hskip 1.0cm 1 centimetre\\
Ceci est un espace de \hskip 2.0cm 2 centimetres\\
Ceci est un espace de \hskip 2.5cm 2.5 centimetres\\
Ceci est un espace de \hskip -1.0cm moins 1 centimetre\\
\stopDemoHN}


\cmd{hfill}, pour sa part, introduit autant d'espace blanc que nécessaire pour occuper toute la ligne, ce qui nous permet de créer des effets intéressants tels que du texte aligné à droite, du texte centré ou du texte des deux côtés de la ligne. Dans le cas de plusieurs \tex{hfill} sur une ligne, ils se répartissent l'espace horizontal de façon équitable. Par exemple~:

\placefigure [force,here,none] [] {}{
\startDemoVW
\hfill hfill pousse à droite.\\
hfill pousse \hfill  des deux côtés.\\
2 hfills \hfill poussent \hfill simultanéement.
\stopDemoVW}

% TODO Garulfo added 

Une dernière commande,  \PlaceMacro{wordright} \tex{wordright}, propose un fonctionnement similaire à \tex{hfill} au sens où elle va pousser le texte qu'elle prend en argument vers la droite, mais elle va en plus automatiquement passer à la ligne, juste après son argument. Voyez~:

\placefigure [force,here,none] [] {}{
\startDemoVW
hfill pousse \hfill des deux côtés. 2 hfills \hfill poussent \hfill simultanéement.

hfill pousse \wordright{des deux côtés.} 2 hfills \hfill poussent \hfill simultanéement.
\stopDemoVW}


\stopsubsection

\stopsection

% **   Section    mots composés

\startsection
  [
    reference=sec:compound words,
    title=Mots composés,
  ]

Par \quotation{mots composés} dans cette section, j'entends les mots qui sont formellement compris comme étant un seul mot, plutôt que les mots qui sont simplement conjoints. Cette distinction n'est pas toujours facile à comprendre : \quotation{portemanteau} est clairement composé de deux mots (\quotation{porte + manteau}) mais aucun francophone ne penserait aux termes combinés d'une autre manière que comme un seul mot. D'autre part, nous avons des mots qui sont parfois combinés à l'aide d'un trait d'union ou d'une barre oblique inversée. Les deux mots ont des significations et des utilisations distinctes, mais ils sont joints (et peuvent dans certains cas devenir un seul mot, mais pas encore !) Ainsi, par exemple, nous pouvons trouver des mots comme \quotation{Français||Canadien} ou \quotation{(inter|)|communication} (bien que nous puissions aussi trouver \quotation{intercommunication} et découvrir que l'usage public a finalement accepté que les deux mots soient un seul mot. C'est ainsi que les langues évoluent).

Les mots composés posent quelques problèmes, principalement liés à leur éventuelle césure en fin de ligne. Si l'élément de jonction est un trait d'union, d'un point de vue typographique, il n'y a pas de problème de césure à la fin d'une ligne à cet endroit, mais nous devrions éviter une deuxième césure dans la deuxième partie du mot, car cela nous laisserait avec deux traits d'union consécutifs qui pourraient causer des difficultés de compréhension.

La commande  \type{||} est disponible pour indiquer à \ConTeXt\ que deux mots forment un mot composé. Cette commande, exceptionnellement, ne commence pas par une barre oblique inverse, et permet deux utilisations différentes~:



\startitemize

\item Nous pouvons utiliser deux barres verticales consécutives (tube ou pipe en anglais) et écrire, par exemple, \type{Espagnol||Argentin}.

\item Les deux barres verticales peuvent être séparée de l'élément de jonction à utiliser entre les deux mots, comme dans, par exemple, \type{joindre|/|séparer}.

\stopitemize

% TODO Garulfo possible de simplifier il me semble

Dans les deux cas, \ConTeXt\ saura qu'il s'agit d'un mot composé et appliquera les règles de césure appropriées pour ce type de mot. La différence entre l'utilisation des deux barres verticales consécutives (tubes), ou l'encadrement du séparateur de mot avec celles-ci, est que dans le premier cas, \ConTeXt\ utilise le séparateur prédéfini comme \PlaceMacro{setuphyphenmark} \tex{setuphyphenmark}, ou en d'autres termes le trait d'union, qui est la valeur par défaut (\MyKey{--}). Ainsi, si nous écrivons \MyKey{après\|\|midi}, \ConTeXt\ générera \quotation{après||midi}. alors qu'avec \MyKey{après\|/\|midi}, \ConTeXt\ générera \quotation{après|/|midi}.

Avec \cmd{setuphyphenmark}, nous pouvons changer le séparateur par défaut (dans le cas où nous utilisons les deux barres verticales). Les valeurs autorisées pour cette commande sont \MyKey{--, ---, -, ~, (, ), =, /}. N'oubliez pas, cependant, que la valeur \MyKey{=} devient un tiret (comme \MyKey{---}).

L'utilisation normale de \MyKey{\|\|} est avec des tirets, puisque c'est ce qui est normalement utilisé entre les mots composés. Mais parfois, le séparateur peut être une parenthèse, si, par exemple, nous voulons obtenir \quotation{(inter)space}, ou il peut être une barre oblique, comme dans \quotation{input/output}. Dans ces cas, si nous voulons que les règles de césure normales pour les mots composés s'appliquent, nous pouvons écrire \MyKey{(inter\|)\|space} ou \MyKey{input\|/\|output}. Comme je l'ai dit précédemment, \MyKey{\|=\|} est considéré comme une abréviation de \MyKey{\|---\|} et insère un tiret em comme séparateur (---).

\stopsection
  
% **   Section    la langue du texte

\startsection
  [
    reference=sec:langdoc,
    title={La langue du texte},
  ]

Les caractères forment des mots qui appartiennent normalement à une certaine langue. Il est important pour \ConTeXt\ de connaître la langue dans laquelle nous écrivons, car un certain nombre de choses importantes en dépendent. Principalement~:

\startitemize[packed]

\item La césure des mots.
\item Le format de sortie de certains mots.
\item Certaines questions de composition associées à la tradition de composition de la langue en question.

\stopitemize

% ***  SubSection définition et modification de la langue

\startsubsection
  [title=Définition et modification de la langue,]

Par défaut, \ConTeXt\ suppose que la langue sera l'anglais. Deux procédures permettent de changer cela~:

\startitemize

\item En utilisant la commande \PlaceMacro{mainlanguage} \tex{mainlanguage}, utilisée en préambule pour changer la langue principale du document. Cela permet d'adapter les éléments générés automatiquement par \ConTeXt . \quotation{Table of content} et \quotation{Chapter}, deviennent respectivement \quotation{Table des matières} ry \quotation{Chapitre}.

\item En utilisant la commande \PlaceMacro{language} \tex{language}, visant à changer la langue active à tout moment du document. Cette commande modifie les règles de césure, les guillemets, etc.

\stopitemize

Les deux commandes attendent un argument consistant en un identifiant (ou code) de langue quelconque. Pour identifier la langue, nous utilisons soit le code international de langue à deux lettres défini dans la norme ISO 639-1, qui est le même que celui utilisé, par exemple, sur le web, soit le nom anglais de la langue en question, ou parfois une abréviation du nom en anglais.

Dans la \in{table}[tbl:languagesa]
\footnote{\in{Table}[tbl:languagesa] a un résumé de la liste obtenue avec les commandes suivantes~:\\
  \PlaceMacro{usemodule}              \type{\usemodule[languages-system]}\\
  \PlaceMacro{loadinstalledlanguages} \type{\loadinstalledlanguages}\\
  \PlaceMacro{showinstalledlanguages} \type{\showinstalledlanguages}\\
Si vous lisez ce document longtemps après qu'il ait été écrit (2020), il est possible que \ConTeXt\ ait incorporé d'autres langues, il serait donc judicieux d'utiliser ces commandes pour afficher une liste mise à jour des langues.},
nous trouvons une liste complète des langues supportées par \ConTeXt, avec le code ISO pour chacune des langues en question ainsi que, le cas échéant, le code pour certaines variantes linguistiques expressément prévues.

{%\switchtobodyfont[script]
\placetable
  [here,force]
  [tbl:languagesa]
  {Support des langues avec \ConTeXt}
{\starttabulate[|p(.2\textwidth)|p(.25\textwidth)|p(.5\textwidth)|]
\HL
\NC{\bf Langage} \NC {\bf Code ISO} \NC {\bf Langage} (variantes)
\NR
\HL
\NC Afrikaans
\NC af, afrikaans
\NR
\NC Arabic
\NC ar, arabic
\NC ar-ae, ar-bh, ar-dz, ar-eg, ar-in, ar-ir, ar-jo, ar-kw, ar-lb, ar-ly, ar-ma, ar-om, ar-qa, ar-sa, ar-sd, ar-sy, ar-tn, ar-ye
\NR
\NC Catalan
\NC ca, catalan
\NR
\NC Czech
\NC cs, cz, czech
\NR
\NC Croatian
\NC hr, croatian
\NR
\NC Danish
\NC da, danish
\NR
\NC Dutch
\NC nl, nld, dutch
\NR
\NC English
\NC en, eng, english
\NC en-gb, uk, ukenglish, en-us, usenglish
\NR
\NC Estonian
\NC et, estonian
\NR
\NC Finnish
\NC fi, finnish
\NR
\NC French
\NC fr, fra, french
\NR
\NC German
\NC de, deu, german
\NC de-at, de-ch, de-de
\NR
\NC Greek
\NC gr, greek
\NR
\NC Greek (ancient)
\NC agr, ancientgreek
\NR
\NC Hebrew
\NC he, hebrew
\NR
\NC Hungarian
\NC hu, hungarian
\NR
\NC Italian
\NC it, italian
\NR
\NC Japanese
\NC ja, japanese
\NR
\NC Korean
\NC kr, korean
\NR
\NC Latin
\NC la, latin
\NR
\NC Lithuanian
\NC lt, lithuanian
\NR
\NC Malayalam
\NC ml, malayalam
\NR
\NC Norwegian
\NC nb, bokmal, no, norwegian
\NC nn, nynorsk
\NR
\NC Persian
\NC pe, fa, persian
\NR
\NC Polish
\NC pl, polish
\NR
\NC Portuguese
\NC pt, portughese
\NC pt-br
\NR
\NC Romanian
\NC ro, romanian
\NR
\NC Russian
\NC ru, russian
\NR
\NC Slovak
\NC sk, slovak
\NR
\NC Slovenian
\NC sl, slovene, slovenian
\NR
\NC Spanish
\NC es, sp, spanish
\NC es-es, es-la
\NR
\NC Swedish
\NC sv, swedish
\NR
\NC Thai
\NC th, thai
\NR
\NC Turkish
\NC tr, turkish
\NC tk, turkmen
\NR
\NC Ukranian
\NC ua, ukrainian
\NR
\NC Vietnamese
\NC vi, vietnamese
\NR
\HL
\stoptabulate
}}

Ainsi, par exemple, pour définir le français comme langue principale du document, nous pouvons utiliser l'une des trois codes suivants~:

\placefigure [force,here,none] [] {}{
\startDemoI
\mainlanguage[fr]
\mainlanguage[fra]
\mainlanguage[french]
\stopDemoI}


Pour activer une langue particulière {\em dans} le document, nous pouvons utiliser soit la commande \cmd{language[Code de la langue]}, soit une commande spécifique pour activer cette langue. Ainsi, par exemple, \PlaceMacro{en} \cmd{en} active l'anglais, \PlaceMacro{fr} \cmd{fr} active le français, \PlaceMacro{es} \cmd{es} espagnol, ou \PlaceMacro{ca} \cmd{ca} le catalan. Une fois qu'une langue a été activée, elle le reste jusqu'à ce que l'on passe expressément à une autre langue, ou que le groupe dans lequel la langue a été activée soit alors fermé. Les langues fonctionnent donc comme des commandes de changement de police. Notez toutefois que la langue définie par la commande \cmd{language} ou par l'une de ses abréviations (\cmd{en}, \cmd{fr}, \PlaceMacro{de}\cmd{de}, etc.) n'affecte pas la langue dans laquelle les étiquettes sont imprimées (voir \in{section}[sec:labels]).


\startSmallPrint

  Bien qu'il puisse être laborieux de marquer la langue de tous les mots et expressions que nous utilisons dans notre document et qui n'appartiennent pas à la langue principale du document, il est important de le faire si nous voulons obtenir un document final correctement composé, en particulier dans les travaux professionnels. Nous ne devons pas marquer tout le texte, mais seulement la partie qui n'appartient pas à la langue principale. Il est parfois possible d'automatiser le marquage de la langue en utilisant une macro. Par exemple, pour ce document dans lequel on cite continuellement des commandes \ConTeXt\, dont la langue d'origine est l'anglais, j'ai conçu une macro qui, en plus d'écrire la commande dans le format et la couleur appropriés, la marque comme un mot anglais. Dans mon travail professionnel, où je dois citer beaucoup de bibliographie française et italienne, j'ai incorporé un champ dans ma base de données bibliographique pour capter la langue de l'ouvrage, de façon à automatiser l'indication de la langue dans les citations et les listes de références bibliographiques.

  Si nous utilisons deux langues qui utilisent des alphabets différents dans le même document (par exemple, l'anglais et le grec, ou l'anglais et le russe), il existe une astuce qui nous évitera de devoir marquer la langue des expressions construites avec l'alphabet alternatif~: modifier le paramètre de la langue principale (voir section suivante) afin qu'il charge également les modèles de césure par défaut pour la langue qui utilise un alphabet différent. Par exemple, si nous voulons utiliser l'anglais et le grec ancien, la commande suivante nous évitera de devoir marquer la langue des textes en grec :

\placefigure [force,here,none] [] {}{
\startDemoI
\setuplanguage[en][patterns={en, agr}
\stopDemoI}

Cela ne fonctionne que parce que l'anglais et le grec utilisent un alphabet différent. Il ne peut donc y avoir de conflit entre les modèles de césure des deux langues, et nous pouvons donc les charger simultanément. Mais dans deux langues qui utilisent le même alphabet, le chargement simultané des modèles de césure conduira nécessairement à une césure inappropriée.

\stopSmallPrint


\stopsubsection

% ***  SubSection configuration de la langue 

\startsubsection
  [
    reference=sec:langconfig,
    title=Configuration de la langue,
  ]
  \PlaceMacro{setuplanguage}

\ConTeXt\ associe le fonctionnement de certains utilitaires à la langue spécifique active à un moment donné. Les associations par défaut peuvent être modifiées avec \cmd{setuplanguage} dont la syntaxe est :

\placefigure [force,here,none] [] {}{
\startDemoI
\setuplanguage[Langage][Configuration]
\stopDemoI}

où {\em Langage} est le code de la langue que nous voulons configurer, et {\em Configuration} contient la configuration spécifique que nous voulons définir (ou modifier) pour cette langue. Plus précisément, jusqu'à 32 options de configuration différentes sont autorisées, mais je ne traiterai que celles qui semblent convenir à un texte d'introduction tel que celui-ci~:

\startitemize

\item {\tt\bf date} : permet de configurer le format de date par défaut. Voir plus loin sur \at{page}[sec:dates].

\item {\tt\bf lefthyphenmin, righthyphenmin} : le nombre minimum de caractères qui doivent se trouver à gauche ou à droite pour que la césure d'un mot soit prise en charge. Par exemple, \cmd{setuplanguage[en][lefthyphenmin=4]} ne prendra pas en charge la césure d'un mot s'il y a moins de 4 caractères à gauche du trait d'union éventuel.

\item {\tt\bf spacing} : les valeurs possibles pour cette option sont \MyKey{broad} ou \MyKey{packed}. Dans le premier cas ({\tt broad}), les règles d'espacement des mots en anglais seront appliquées, ce qui signifie qu'après un point et lorsqu'un autre caractère suit, une certaine quantité d'espace vide supplémentaire sera ajoutée. En revanche, \MyKey{spacing=packed} empêchera l'application de ces règles. Pour l'anglais, {\tt broad} est la valeur par défaut.

\item {\tt\bf leftquote, rightquote} : indique les caractères (ou commandes), respectivement, que \tex{quote} utilisera à gauche et à droite du texte qui est son argument (pour cette commande, voir \at{page}[sec:quote]).

\item {\tt\bf leftquotation, rightquotation} : indique les caractères (ou commandes), respectivement que \tex{quotation} utilisera à gauche et à droite du texte qui est son argument (pour cette commande, voir \at{page}[sec:quote]).

\stopitemize

% TODO Garulfo added

Voyez par exemple l'effet des configurations par défaut~:

\placefigure [force,here,none] [] {}{
\startDemoHN
\language[en] \quotation{Mon texte} et \quote{Mon texte} \\
\language[de] \quotation{Mon texte} et \quote{Mon texte} \\
\language[fr] \quotation{Mon texte} et \quote{Mon texte}
\stopDemoHN}

Dans le cas particulier du français, n'oubliez pas d'utiliser \tex{setcharacterspacing[frenchpunctuation]} qui indique à \ConTeXt\ d'ajouter des espaces fines insécables devant les signes doubles (mais pas après, sauf pour «). Il n'enlève pas les espaces en trop donc il vous faudra tout de même faire attention au niveau du fichier source. Vous pouvez aussi configurer directement ce comportement avec \tex{setupcharacterspacing}.
\PlaceMacro{setupcharacterspacing}




\placefigure [force,here,none] [] {}{
\startDemoHN%
\language[fr]%
A - Une phrase,avec des,signes simples.\\
B - Une:phrase;avec des signes! doubles?\\
C - Une phrase , avec des , signes simples .\\
D - Une : phrase ; avec des signes ! doubles ?\\
E - et\quote{Mon texte}pour finir.\\

\blank[big]
\setcharacterspacing   [frenchpunctuation]

A - Une phrase,avec des,signes simples.\\
B - Une:phrase;avec des signes! doubles?\\
C - Une phrase , avec des , signes simples .\\
D - Une : phrase ; avec des signes ! doubles ?\\
E - et\quote{Mon texte}pour finir.\\

\blank[big]
\setupcharacterspacing [frenchpunctuation] ["003A]  % pour :
                       [left=.75,right=.75,alternative=1] 
% ["003A]: ["003B]; ["003F]? ["0021]! ["002C], ["002E]. ["00AB]« ["00BB]»

B - Une:phrase;avec des signes! doubles?
\stopDemoHN}

\stopsubsection

% ***  SubSection étiquettes associées à des langues particulières,

\startsubsection
  [
    reference=sec:labels,
    title=Étiquettes associées à des langues particulières,
  ]

De nombreuses commandes de \ConTeXt\ génèrent automatiquement certains textes (ou {\em étiquettes}), comme, par exemple, la commande \tex{placetable} qui écrit l'étiquette \quotation{Tableau xx} sous le tableau qui est inséré, ou \tex{placefigure} qui insère l'étiquette \quotation{Figure xx}.

Ces {\em étiquettes} dépendent de la langue définie avec \tex{mainlanguage}. (mais pas de \tex{language} qui ne concerne que les règles de césure, ponctuations, guillements etc.) et nous pouvons les modifier avec la commande~:

\PlaceMacro{setuplabeltext}
\placefigure [force,here,none] [] {}{
\startDemoI
\setuplabeltext[Language][Clé=Texte]
\stopDemoI}

où {\em Clé} est le terme par lequel \ConTeXt\ connaît l'étiquette et {\em Texte} est le texte que nous voulons que \ConTeXt\ génère. Ainsi, par exemple,

\PlaceMacro{setuplabeltext}
\placefigure [force,here,none] [] {}{
\startDemoVW
\mainlanguage[fr]%
\setuplabeltext[fr][figure={Illustration~}]
\placefigure [] [] {Texte de la légende} {Texte}
\stopDemoVW}

implique que lorsque la langue principale est le  français, les images insérées avec \cmd{placefigure} ne sont pas appelées \quotation{Figure x} mais \quotation{Illustration x}. Notez qu'après le texte de l'étiquette proprement dite, il faut laisser un espace vide pour que l'étiquette ne soit pas rattachée au caractère suivant qui est la numérotation de la figure. Dans l'exemple, j'ai utilisé le caractère réservé \quotation{\lettertilde} ; j'aurais également pu écrire \MyKey{[figure=Illustration\{ \}]} en enfermant l'espace vide entre des accolades pour m'assurer que \ConTeXt\ ne s'en débarrasse pas.

Quelles étiquettes pouvons-nous redéfinir avec \cmd{setuplabeltext} ? La documentation de \ConTeXt\ n'est pas aussi complète qu'on pourrait l'espérer sur ce point. Le manuel de référence 2013 (qui est celui qui explique le plus cette commande) mentionne \MyKey{chapter}, \MyKey{table}, \MyKey{figure}, \MyKey{appendix}... \Conjecture et ajoute \quotation{autres éléments de texte comparables}. Nous pouvons notamment identifier 
\MyKey{content},
\MyKey{tables}, 
\MyKey{figures},
\MyKey{index},
\MyKey{intermezzo}, 
\MyKey{intermezzi}, 
\MyKey{graphic}, 
\MyKey{graphics}
\MyKey{abbreviations},
\MyKey{logos}
\MyKey{units}, 
\MyKey{part},
\MyKey{section}
\MyKey{section}, 
\MyKey{subsection},
\MyKey{subsubsection}
\MyKey{subsubsubsection},
\MyKey{line},
\MyKey{lines},
\MyKey{page},
\MyKey{atpage},
\MyKey{hencefore},
\MyKey{hereafter},
\MyKey{see}.

\startSmallPrint


L'un des avantages des {\em  logiciels libres} est la disponibilité des fichiers sources ; nous pouvons donc les examiner. C'est ce que j'ai fait, et en fouinant dans les fichiers sources de ConTeXt, j'ai découvert le fichier 
\goto{\tt lang-txt.lua}[url(https://source.contextgarden.net/tex/context/base/mkiv/lang-txt.lua)], disponible dans {\tt tex/texmf-context/tex/context/base/mkiv} qui, je pense, est celui qui contient les étiquettes prédéfinies et leurs différentes traductions ; de sorte que si à tout moment \ConTeXt\ génère un texte redéfini que nous voulons changer, pour identifier le nom de l'étiquette à laquelle ce texte est associé il suffit de consulter ce fichier.

\stopSmallPrint

Si nous voulons insérer le texte associé à une certaine étiquette quelque part dans le document, nous pouvons le faire avec la commande \PlaceMacro{labeltext} \tex{labeltext}. Ainsi, par exemple, si je veux faire référence à un tableau, pour m'assurer que je le nomme de la même manière que \ConTeXt\ dans la commande \cmd{placetable}, je peux écrire : \quotation{\tt Juste comme indiqué dans le \backslash labeltext\{table\} de la page suivante.}.

\placefigure [force,here,none] [] {}{
\startDemoVW
\useMPlibrary [dum] % pour produire des images
\mainlanguage[fr]   %
\setuplabeltext[fr][figure={Illustration~}]
\placefigure [] [] 
  {Texte de la légende}
  {\externalfigure [dummy] 
     [height=1cm,width=6cm]}

Juste comme indiqué dans l'\labeltext{figure} précédente.
\stopDemoVW}

\startSmallPrint

 Certaines étiquettes redéfinissables avec \tex{setuplabeltext}, sont vides par défaut ; comme, par exemple, \MyKey{chapter} ou \MyKey{section}. Cela est dû au fait que, par défaut, \ConTeXt\ n'ajoute pas d'étiquettes aux commandes de sectionnement. Si nous voulons changer ce fonctionnement par défaut, il nous suffit de redéfinir ces étiquettes dans le préambule de notre document et ainsi, par exemple, \cmd{setuplabeltext[chapter=Chapter\lettertilde]} verra que les chapitres sont précédés du mot \quotation{Chapter}.

\placefigure [force,here,none] [] {}{
\startDemoVW
\mainlanguage[fr]%
\setuplabeltext[fr][section={Verset~}]

\startsection[title=Titre de section]
\stopsection
\stopDemoVW}

\stopSmallPrint


Enfin, il est important de souligner que bien qu'en général, dans \ConTeXt, les commandes qui permettent plusieurs options séparées par des virgules comme argument, la dernière option peut se terminer par une virgule et rien de mal ne se passe. Dans \tex{setuplabeltext}, cela générerait une erreur lors de la compilation.

\stopsubsection

% ***  SubSection quelques commandes liées à la langue

\startsubsection
  [title=Quelques commandes liées à la langue]

% **** SubSubSection date

\startsubsubsection
  [
    reference=sec:dates,
    title=Commandes liées à la date,
  ]
  \PlaceMacro{currentdate} \PlaceMacro{date} \PlaceMacro{month}


\ConTeXt\ a trois commandes liées à la date qui produisent une sortie dépendante de la langue active au moment où elles sont exécutées. Il s'agit de :


\startitemize

\item \tex{currentdate} : exécutée sans arguments dans un document dont la langue principale est l'anglais, elle renvoie la date système au format \quotation{Jour Mois Année}. Par exemple \quotation{11 septembre 2020}. Mais nous pouvons également lui demander d'utiliser un format différent (comme c'est le cas aux États-Unis et dans certaines autres parties du monde anglophone qui suivent leur système consistant à placer le mois avant le jour, d'où la date tristement célèbre du 11 septembre), ou d'inclure le nom du jour de la semaine ({\tt weekday}), ou de n'inclure que certains éléments de la date ({\tt day, month, year}). 

Pour indiquer un format de date différent, \MyKey{dd} ou \MyKey{day} représentent les jours, \MyKey{mm} les mois (au format numérique), \MyKey{month} les mois au format alphabétique en minuscules, et \MyKey{MONTH} en majuscules. En ce qui concerne l'année, \MyKey{yy} n'écrira que les derniers chiffres, tandis que \MyKey{year} ou \MyKey{y} écrira les quatre. Si nous voulons un élément de séparation entre les composants de la date, nous devons l'écrire expressément. Par exemple

\placefigure [force,here,none] [] {}{
\startDemoVW%
\mainlanguage[en] \language[en]%
\currentdate[weekday,month,day,{, },year]

\mainlanguage[fr] \language[fr]%
\currentdate[weekday,day,month,year]
\stopDemoVW}
  
\item \tex{date} : cette commande, exécutée sans aucun argument, produit exactement le même résultat que \cmd{currentdate}, c'est-à-dire la date actuelle au format standard. Cependant, une date spécifique peut être donnée comme argument. Deux arguments sont fournis pour cela : avec le premier argument, nous pouvons indiquer le jour (\MyKey{d}), le mois (\MyKey{m}) et l'année (\MyKey{y}) correspondant à la date que nous voulons représenter, tandis qu'avec le second argument (facultatif), nous pouvons indiquer le format de la date à représenter. Par exemple, si nous voulons savoir quel jour de la semaine John Lennon et Paul McCartney se sont rencontrés, un événement qui, selon Wikipedia, a eu lieu le 6 juillet 1957, nous pourrions écrire

\placefigure [force,here,none] [] {}{
\startDemoVN%
\mainlanguage[fr] \language[fr]%
\date[d=6, m=7, y=1957][weekday]
\stopDemoVN}

et ainsi nous découvrons qu'un tel événement historique s'est produit un samedi. 

\item \tex{month} prend un nombre en argument, et renvoie le nom du mois correspondant à ce nombre.
  
\stopitemize

Pour l'heure, il existe aussi \tex{currenttime} qui prend en argument \MyKey{h} pour les heures et \MyKey{m} pour les minutes. 

\stopsubsubsection

% **** SubSubSection translate

\startsubsubsection
  [title=La commande \tex{translate}]
  \PlaceMacro{translate}

La commande \tex{translate} prend en charge une série de phrases associées à une langue spécifique, de sorte que l'une ou l'autre sera insérée dans le document final en fonction de la langue active à un moment donné. Dans l'exemple suivant, la commande translate est utilisée pour associer quatre phrases au français et à l'anglais, qui sont enregistrées dans un tampon de mémoire (concernant l'environnement {\tt buffer}, voir \in{section}[sec:buffer]). Si nous insérons le {\em tampon} à un point du document où le français est activé, les phrases en français seront affichées, et de même avec l'anglais. Ainsi :

\placefigure [force,here,none] [] {}{
\startDemoHW%
\startbuffer
\starttabulate[|*{4}{lw(3cm)|}]
\HL \NC \translate[fr=Votre lettre,    en=Your letter]
    \NC \translate[fr=Votre référence, en=Your reference]
    \NC \translate[fr=Notre référence, en=Our reference]
    \NC \translate[fr=Date,            en=Date] \NR
  \stoptabulate
\stopbuffer

\language[fr]  \getbuffer
\blank[big]
\language[en]  \getbuffer
\stopDemoHW}

%\stoppacked

\stopsubsubsection

% **** SubSubSection commandes \tex{quote} et \tex{quotation}

\startsubsubsection
  [
    reference=sec:quote,
    title=Les commandes \tex{quote} et \tex{quotation},
  ]
  \PlaceMacro{quote}\PlaceMacro{quotation}

L'une des erreurs typographiques les plus courantes dans les documents texte survient lorsque les guillemets (simples ou doubles) sont ouverts mais pas expressément fermés. Pour éviter cela, \ConTeXt\ fournit les commandes \tex{quote} et \tex{quotation} qui citeront le texte qui est leur argument ; \tex{quote} utilisera des guillemets simples et \tex{quotation} des guillemets doubles.

Ces commandes sont sensibles à la langue dans la mesure où elles utilisent le jeu de caractères ou de commandes par défaut de la langue en question pour ouvrir et fermer les guillemets (cf. \in{section} [sec:langconfig]) ; Dans l'exemple suivant, vous voyez la configuration pour le français par défaut puis une version utlisant les versionŝ anglais des guillemets simples et doubles.

\placefigure [force,here,none] [] {}{
\startDemoHW%
\setcharacterspacing   [frenchpunctuation]%
\mainlanguage[fr] \language[fr]%
\tfd \quotation{Mon texte} et \quote{Mon texte}
\blank[big]
\setuplanguage[fr][leftquotation=“,rightquotation=”]
\setuplanguage[en][leftquote=‘,rightquote=’]
\tfd \quotation{Mon texte} et \quote{Mon texte}
\stopDemoHW}


Ces commandes ne gèrent cependant pas les guillemets imbriqués, bien que nous puissions créer un utilitaire qui le fasse, en profitant du fait que \cmd{quote} et \cmd{quotation} sont des applications réelles de ce que \ConTeXt\ appelle {\em delimitedtext}, et qu'il est possible de définir d'autres applications avec \PlaceMacro{definedelimitedtext} \tex{definedelimitedtext}. Ainsi, l'exemple suivant :


crée trois commandes qui permettront jusqu'à trois niveaux différents de citation. Le premier niveau avec des guillemets latéraux, le deuxième avec des guillemets doubles et le troisième avec des guillemets simples.

Bien entendu, si nous utilisons l'anglais comme langue principale, les guillemets simples et doubles par défaut (frisés, et non droits, comme dans ce document !) seront automatiquement utilisés.


\placefigure [force,here,none] [] {}{
\startDemoHW%
\definedelimitedtext [GuillemetsNivA] [left=«, right=»]
\definedelimitedtext [GuillemetsNivB] [left=“, right=”]
\definedelimitedtext [GuillemetsNivC] [left=', right=']

\GuillemetsNivA{Mon texte et \GuillemetsNivB{un second et \GuillemetsNivC{un troisième}}} 
\stopDemoHW}

\stopsubsubsection

\stopsubsection

\stopsection

% *    End

\stopchapter

\stopcomponent

%%% Local Variables:
%%% mode: ConTeXt
%%% mode: auto-fill
%%% coding: utf-8-unix
%%% TeX-master: "../introCTX_fra.tex"
%%% End:
%%% vim:set filetype=context tw=72 : %%%
