%%% File:     b06_Fonts.mkiv
%%% Author:   Joaquín Ataz-López
%%% Begun:    March 2020
%%% Concluded: June 2020
%%% Title:  This chapter was the first chapter I began. I came back to
%%%         it often because I wanted it to include the use of
%%%         fonts installed on our system. But I didn't
%%%         succeed in getting the instructions in the wiki to
%%%         work. Recently (August) I discovered fonttest which
%%%         can be accessed after running mtxrun --script server --auto
%%%         I need to investigate further. This "sees" the fonts
%%%         installed on my system and tells me what code I need
%%%         to use them. But I stll don't understand how it
%%%         works. The key might possibly lie in the "Fonts
%%%         out of ConTeXt" manual, but i struggle to understand it.
%%%
%%% Edited with: Emacs + AuTeX - And at times vim + context-plugin
%%%

\environment introCTX_env

\startcomponent b06_Fonts

\startchapter
  [
    reference=cap:fontscol,
    title=Polices de caractères et couleurs dans \ConTeXt,
    bookmark=Fonts and colours in ConTeXt,
  ]

\TocChap

% * SECTION 6.1 polices incluses

\startsection
  [title=Polices de caractères incluses dans\\ \suite- ]

Le système de polices de \ConTeXt\ offre de nombreuses possibilités, mais il est également assez complexe. Je n'analyserai pas toutes les possibilités avancées de polices dans ce manuel, mais je me limiterai à supposer que nous travaillons avec certaines des 21 polices fournies avec l'installation de \ConTeXt\ Standalone, celles présentées dans \in{table}[tbl:ctx-fonts].


% TODO Garulfo : antykwapoltawskiego KO, idem pour antykwa toutes les polices ne passent pas (peutêtre à cause de la taille de police?)

{\switchtobodyfont[small]
\definebodyfontenvironment[10pt]
\placetable
  [here]
  [tbl:ctx-fonts]
  {Fonts included in the \ConTeXt\ distribution}{%
\starttabulate[|l|l|w{2cm}|]
\HL
\NC{\bf Nom official}    \NC{\bf Référence \ConTeXt}         \NC{\bf Exemple} \NR
\HL
\NC Latin Modern         \NC modern, modern-base             \NC{\switchtobodyfont[modern,10pt] Emily Brontë's book}                   \NR
\NC Latin Modern Variable\NC modernvariable, modern-variable \NC{\switchtobodyfont[modernvariable,10pt] Emily Brontë's book}           \NR
\HL
\NC TeX Gyre Adventor    \NC adventor, avantgarde            \NC{\switchtobodyfont[adventor,10pt] Emily Brontë's book}                 \NR
\NC TeX Gyre Bonum       \NC bonum, bookman                  \NC{\switchtobodyfont[bonum,10pt] Emily Brontë's book}                    \NR
\NC TeX Gyre Cursor      \NC cursor, courier                 \NC{\switchtobodyfont[cursor,10pt] Emily Brontë's book}                   \NR
\NC TeX Gyre Heros       \NC heros, helvetica                \NC{\switchtobodyfont[heros,10pt] Emily Brontë's book}                    \NR
\NC TeX Gyre Schola      \NC schola, schoolbook              \NC{\switchtobodyfont[schola,10pt] Emily Brontë's book}                   \NR
\NC Tex Gyre Chorus      \NC chorus, chancery                \NC{\switchtobodyfont[chorus,10pt] Emily Brontë's book}                   \NR
\NC Tex Gyre Pagella     \NC pagella, palatino               \NC{\switchtobodyfont[pagella,10pt] Emily Brontë's book}                  \NR
\NC Tex Gyre Termes      \NC termes, times                   \NC{\switchtobodyfont[termes,10pt] Emily Brontë's book}                   \NR
\HL
\NC DejaVu               \NC dejavu                          \NC{\switchtobodyfont[dejavu,10pt] Emily Brontë's book}                   \NR
\NC                      \NC dejavu-condensed                \NC{\switchtobodyfont[dejavu-condensed,10pt] Emily Brontë's book}         \NR
\HL
\NC Gentium              \NC gentium                         \NC{\switchtobodyfont[gentium,10pt] Emily Brontë's book}                  \NR  
\NC Antykwa Poltawskiego \NC antykwapoltawskiego             \NC{\switchtobodyfont[antykwa-poltawskiego,10pt] Emily Brontë's book}     \NR  
\NC Antykwa Toruńska     \NC antykwatorunska                 \NC{\switchtobodyfont[antykwa,10pt] Emily Brontë's book}                  \NR
\NC Iwona                \NC iwona                           \NC{\switchtobodyfont[iwona,10pt] Emily Brontë's book}                    \NR
\NC Kurier               \NC kurier                          \NC{\switchtobodyfont[kurier,10pt] Emily Brontë's book}                   \NR
\NC PostScript           \NC postscript                      \NC{\switchtobodyfont[postscript,10pt] Emily Brontë's book}               \NR
\HL
\NC Euler                \NC eulernova                       \NC{\switchtobodyfont[eulernova,10pt] Emily Brontë's book}                \NR
\NC Stix2                \NC stix                            \NC{\switchtobodyfont[stix,10pt] Emily Brontë's book}                     \NR
\NC Xits                 \NC xits                            \NC{\switchtobodyfont[xits,10pt] Emily Brontë's book}                     \NR
\HL
\stoptabulate
}}


La colonne centrale de \in{table}[tbl:ctx-fonts] indique le ou les noms par lesquels \ConTeXt\ connaît la police en question. Lorsqu'il y a deux noms, ils sont synonymes. La dernière colonne présente un exemple de la police utilisée. Quant à l'ordre dans lequel les polices sont présentées, la première est la police que \ConTeXt\ utilise par défaut, les autres polices sont classées par ordre alphabétique, tandis que les trois dernières polices sont spécifiquement conçues pour les mathématiques. Notez que la police Euler ne peut pas représenter directement les lettres accentuées, nous obtenons donc Bront's, et non Brontë's.

Pour les lecteurs venant du monde Windows et de ses polices par défaut, j'indiquerai que {\em heros} équivaut à Arial dans Windows, tandis que {\em termes} équivaut à Times New Roman. Elles ne sont pas exactement les mêmes mais suffisamment similaires, au point qu'il faudrait être très observateur pour faire la différence.

  \startSmallPrint
     
Les polices utilisées par Windows ne sont pas des {\em logiciels libres} (en fait, presque rien dans Windows n'est un {\em logiciel libre}), elles ne peuvent donc pas être incluses dans une distribution de \ConTeXt. Cependant, si \ConTeXt\ est installé sous Windows, alors ces polices sont déjà installées et peuvent être utilisées comme n'importe quelle autre police installée sur le système exécutant \ConTeXt. Dans cette introduction, cependant, je ne traiterai pas de la manière d'utiliser les polices déjà installées sur le système. Vous trouverez de l'aide à ce sujet sur le wiki \goto{\ConTeXt}[url(wiki)].

% TODO GArulfo compléter avec  https://wiki.contextgarden.net/Fonts

  \stopSmallPrint

\stopsection

% * SECTION 6.2 caractéristiques d'une police 

\startsection
  [title=Caractéristiques d'une police]

% ** Subsection styles et variantes de style

\startsubsection
  [title={Polices, {\em styles} et {\em styles alternatifs}}]

La terminologie concernant les polices est quelque peu confuse, car parfois ce que l'on appelle une police est en réalité une {\em famille de polices} qui comprend différents styles et variantes partageant un design de base. Je n'entrerai pas dans la question de savoir quelle terminologie est la plus correcte ; je m'intéresse uniquement à la clarification de la terminologie utilisée dans \ConTeXt. Ce dernier fait une distinction entre les polices, les styles et les variantes (ou alternatives) pour chaque style. Les {\em polices} incluses dans la distribution \ConTeXt\ (il s'agit en fait de {\em familles de polices}) sont celles que nous avons vues dans la section précédente. Nous allons maintenant nous pencher sur les {\em styles} et les {\em alternatives}.


\subsubsubject{Style de police}


\dontleavehmode{\sc Donald E. Knuth} a conçu la police {\em Computer Modern} pour \TeX, en lui donnant trois {\em styles} distincts appelés {\em roman}, {\em sans serif} et {\em teletype}. Le style {\em roman} est une conception dans laquelle les caractères présentent des \quotation{empattements} à chaque extrémité, ou \quotation{sérif} dans en jargon typographique, ce qui explique pourquoi ce style de police est également connu sous le nom {\em serif}. Ce style était considéré comme le style normal ou par défaut. Le style {\em sans serif}, comme son nom l'indique, est dépourvu de ces empattements et constitue donc une police plus simple et plus stylisée, parfois connue sous d'autres noms, par exemple en français, {\em linéale} ; cette police peut être la police principale du document, mais elle est également appropriée pour être utilisée pour distinguer certains fragments d'un texte dont la police principale est de style {\em romain}, comme, par exemple, les titres ou les en-têtes de page. Enfin, la police {\em teletype} a été incluse dans la police {\em Computer Roman} car elle a été conçue pour l'écriture de livres de programmation informatique, comportant de grandes sections de code informatique qui sont conventionnellement représentées, dans les documents imprimés, dans un style monospace qui imite les terminaux informatiques et les anciennes machines à écrire. Voici une illustration~:

% TODO Garulfo rajoué

{\switchtobodyfont[modern,12pt]%
\startitemize[packed]
\item {\rm Style avec sérif}
\item {\ss Style sans sérif}
\item {\tt Style monospace}
\stopitemize}

  \startSmallPrint

Un quatrième style destiné aux fragments de mathématiques pourrait être ajouté à ces trois styles de police. Mais comme \TeX\ utilise automatiquement ce style lorsqu'il entre en mode mathématique, et qu'il n'inclut pas de commandes pour l'activer ou le désactiver expressément, et qu'il ne possède pas non plus les {\em variantes de style} ou les alternatives des autres styles, il n'est pas habituel de le considérer comme un {\em style} proprement dit.

\ConTeXt\ inclut des commandes pour deux styles supplémentaires possibles : manuscrit et calligraphique. Je ne suis pas exactement sûr de la différence entre eux car, d'une part, aucune des polices incluses dans la distribution de \ConTeXt\ inclut ces styles dans leur conception, et d'autre part, comme je le vois, l'écriture calligraphique est également manuscrite. Ces commandes que \ConTeXt\ inclut pour activer de tels styles, si elles sont utilisées avec une police qui ne les implémente pas, ne causeront aucune erreur lors de la compilation : c'est simplement que rien ne se passe.

  
  \stopSmallPrint

\subsubsubject{Styles alternatifs}

Chaque {\em style} offre un certain nombre de styles alternatifs, et c'est ainsi que le \ConTeXt\ les appelle, ({\em alternative}) :

\startitemize[2,packed]

\item Régulier (Regular) ou normal (\MyKey{tf}, à partir de {\em typeface})~:
      {\tf style regular}
\item Gras (Bold) (\MyKey{bf}, à partir de {\em boldface})~:
      {\bf style gras}
\item Italique (Italic) (\MyKey{it}, à partir de {\em italic})~:
      {\it style itamique}
\item Gras Italique (BoldItalic) (\MyKey{bi}, à partir de  {\em bold italic})~:
      {\bi style gras italique}
\item Oblique (Slanted) (\MyKey{sl} à partir de  {\em slanted})~:
      {\sl style slanted}
\item Gras Oblique (BoldSlanted) (\MyKey{bs} à partir de  {\em bold slanted})~:
      {\bs style gras oblique}
\item Petites Majuscules (Small caps) (\MyKey{sc} à partir de  {\em small caps})~:
      {\sc style small caps}
\item Médieval (Medieval) (\MyKey{os} à partir de  {\em old style})~:
      {\os style medieval}

\stopitemize

Ces {\em alternatives}, comme leur nom l'indique, sont mutuellement exclusives : lorsque l'une d'elles est activé, les autres sont désactivés. C'est pourquoi \ConTeXt\ fournit des commandes pour les activer mais pas pour les désactiver ; parce que lorsque nous activons une alternative, nous désactivons celle que nous utilisions jusqu'alors ; et donc, par exemple, si nous écrivons en italique et que nous activons le gras, l'italique sera désactivé. Si nous voulons utiliser simultanément le gras et l'italique, nous ne devons pas activer l'un puis l'autre, mais  activer l'alternative qui inclut les deux (\MyKey{bi}).

D'autre part, il faut garder à l'esprit que même si \ConTeXt\ suppose que chaque police aura ces alternatives, et fournit donc des commandes pour les activer, pour fonctionner et produire un effet perceptible dans le document final, ces commandes ont besoin que la police ait des styles spécifiques dans sa conception pour chaque style et alternative.

\startSmallPrint

En particulier, de nombreuses polices ne font pas la différence dans leur conception entre les lettres inclinées et italiques, ou n'incluent pas de styles spéciaux pour les petites majuscules.

\stopSmallPrint

\subsubsubject{Différence entre l'italique et l'oblique}

La similitude de la fonction typographique assurée par l'italique et l'oblique conduit de nombreuses personnes à confondre ces deux alternatives. La lettre oblique est obtenue par une légère rotation du style régulier. Mais l'italique implique -- du moins dans certaines polices -- une conception différente dans laquelle les lettres {\em semblent} inclinées parce qu'elles ont été dessinées pour y ressembler ; mais en réalité, il n'y a pas d'inclinaison authentique. C'est ce que montre l'exemple suivant, dans lequel nous avons écrit le même mot trois fois à la même taille suffisamment grande pour qu'il soit facile d'apprécier les différences. Dans la première version, le style régulier est utilisé, dans la deuxième, l'inclinaison, et dans la troisième, l'italique~:

\placefigure [here,none] [] {}{
\startDemoHW
\definebodyfontenvironment[44pt]
\setupbodyfont[modern,44pt]
{\rm italics} -- 
{\sl italics} -- 
{\it italics}
\stopDemoHW}

Notez que le dessin des caractères est le même dans les deux premiers exemples, mais que dans le troisième, il y a de subtiles différences dans les traits de certaines lettres, ce qui est très évident, notamment dans la façon dont le \quote{a} est dessiné, bien que les différences se produisent en fait dans presque tous les caractères.

Les utilisations habituelles des lettres italiques et inclinées sont similaires et chaque personne décide d'utiliser l'une ou l'autre. Il y a là une liberté, même s'il faut souligner qu'un document sera mieux composé et aura un meilleur aspect si l'utilisation de l'italique et des lettres obliques est {\em cohérente}. De plus, dans de nombreuses polices, la différence de conception entre l'italique et l'oblique est négligeable, de sorte que l'utilisation de l'une ou de l'autre ne fait aucune différence.

D'autre part, l'italique et l'oblique sont tous deux des alternatives aux polices de caractères, ce qui signifie principalement deux choses~:


\startitemize[n]

\item Nous ne pouvons les utiliser que lorsqu'elles sont définies dans la police.

\item Lorsqu'on active l'une d'entre elles, on désactive l'alternative qui était utilisée jusqu'alors.

\stopitemize

Outre les commandes d'italique et d'oblique, \ConTeXt\ offre une commande supplémentaire pour {\em mettre en valeur} un texte particulier. Son utilisation implique des différences subtiles par rapport à l'italique ou à l'incliné. Voir \in{section}[sec:emphasis].

\stopsubsection

% ** Subsection font size

\startsubsection
  [title=Taille de police]

Toutes les polices gérées par \ConTeXt\ sont basées sur des graphiques vectoriels, de sorte qu'en théorie elles peuvent être affichées à n'importe quelle taille de police, bien que, comme nous le verrons, cela dépende des instructions réelles que nous utilisons pour déterminer la taille de la police. Sauf indication contraire, il est supposé que la taille de la police sera de 12 points.

\startSmallPrint

Toutes les polices utilisées par \ConTeXt\ sont basées sur le graphisme vectoriel, et sont donc des polices Opentype ou Type 1, ce qui implique que les polices dont les origines sont antérieures à cette technologie ont été réimplémentées. En particulier, la police par défaut de \TeX\, {\em Computer Modern}, conçue par {\sc Knuth}, n'existait que dans certaines tailles, et a donc été réimplémentée dans une conception appelée {\em Latin Modern} utilisée par \ConTeXt, bien que dans de nombreux documents, elle continue d'être appelée {\em Computer Modern} en raison du fort symbolisme que cette police a toujours pour les systèmes \TeX, puisque ceux-ci ont été créés et développés par {\sc Knuth} en même temps qu'un autre programme appelé \MetaFont, destiné à concevoir des polices pouvant fonctionner avec \TeX.

\stopSmallPrint

\stopsubsection

\stopsection

% * SECTION 6.3 police principale 

\startsection
  [
    reference=sec:mainfont,
    title=Définition de la police principale du document,
  ]
\PlaceMacro{setupbodyfont}

Par défaut, sauf si une autre police est indiquée, \ConTeXt\ utilisera {\em Latin Modern Roman} à 12 points comme police principale. Cette police a été conçue à l'origine par {\sc Knuth} pour être implémentée dans \TeX. Il s'agit d'une police élégante de style romain avec de grandes variations d'épaisseur et des empattements -- appelées {\em serifs} -- dans certains traits, ce qui est très approprié à la fois pour les textes imprimés et pour l'affichage à l'écran ; cependant -- et c'est une opinion personnelle -- elle n'est pas si adaptée aux petits écrans comme le {\em smartphone}, parce que les {\em serifs} ou les fioritures ont tendance à s'empiler, rendant la lecture difficile.

Pour configurer une police différente, nous utilisons \tex{setupbodyfont} qui nous permet non seulement de changer la police actuelle, mais aussi sa taille et son style. Si nous voulons que cette option s'applique à l'ensemble du document, nous devons l'inclure dans le préambule du fichier source. Mais si nous souhaitons simplement changer la police à un moment donné, c'est ici que nous devons inclure ce qui suit.

Le format \tex{setupbodyfont} est le suivant :

\placefigure [here,none] [] {}{
\startDemoI
\setupbodyfont[Options]
\stopDemoI}

{\tfx\setup{setupbodyfont}}

où les différentes options de la commande nous permettent d'indiquer~:

\startitemize

\item {\bf Le nom de la police}, qui peut être n'importe lequel des noms de police symboliques trouvés dans \in{table}[tbl:ctx-fonts].

\item {\bf La taille}, qui peut être indiquée soit par ses dimensions (en utilisant le point comme unité de mesure), soit par certains noms symboliques. Mais notez que même si j'ai dit précédemment que les polices utilisées par \ConTeXt\ peuvent être mises à l'échelle à pratiquement n'importe quelle taille, dans \tex{setupbodyfont}, seules les tailles constituées de nombres entiers compris entre 4 et 12, ainsi que les valeurs 14,4 et 17,3, sont prises en charge par \ConTeXt. Par défaut, il suppose que la taille est de 12 points.

\tex{setupbodyfont}, établit ce que l'on pourrait appeler la taille de base du document, c'est-à-dire la taille de caractère normale sur la base de laquelle sont calculées les autres tailles, par exemple les titres et les notes de bas de page. Lorsque nous modifions le corps principal avec \tex{setupbodyfont}, tous les autres corps calculés sur la base de la police principale sont également modifiés.

En plus d'indiquer directement le corps de caractère (10pt, 11pt, 12pt, etc.), nous pouvons également utiliser certains noms symboliques qui calculent le corps de caractère à appliquer, sur la base du corps actuel. Les noms symboliques en question sont, du plus grand au plus petit : big, small, script, x, scriptscript et xx. Ainsi, par exemple, si nous voulons définir un corps de texte avec \tex{setupbodyfont} dont la taille est supérieure à 12 points, nous pouvons le faire avec \MyKey{big}.


% TODO rajouté par Garufo - début

\PlaceMacro{definebodyfontenvironment}

Pour utiliser une taille de police différentes de celles disponibles par défaut, il est nécessaire de la déclarer avec \tex{definebodyfontenvironment} préalablement à l'utilisation de \tex{setupbodyfont}.

\placefigure [here,none] [] {}{
\startDemoVN
\setupbodyfont[modern,17.3pt]
Coucou
\stopDemoVN}

\placefigure [here,none] [] {}{
\startDemoVN
\setupbodyfont[modern,17.5pt]
Coucou
\stopDemoVN}

\placefigure [here,none] [] {}{
\startDemoVN
\definebodyfontenvironment[17.5pt]
\setupbodyfont[modern,17.5pt]
Coucou
\stopDemoVN}

% TODO rajouté par Garufo - fin


\item {\bf le style de police}, qui, comme nous l'avons indiqué, peut être romain (avec empattements), ou sans empattements (sans serif), ou style machine à écrire, et pour certaines polices, style manuscrit et calligraphique. \tex{setupbodyfont} autorise différents noms symboliques pour indiquer les différents styles. Ceux-ci se trouvent dans la table \in[tab:ctx-stylesstbdf]~:


  {%\switchtobodyfont[modern] 
    \placetable %
      [here, force] %
      [tab:ctx-stylesstbdf] %
      {Styles avec setupbodyfont} %
      {\startxtable %
        \startxrow [topframe=on, bottomframe=on]%
          \startxcell \bf Style \stopxcell %
          \startxcell \bf Noms symboliques autorisés\stopxcell %
        \stopxrow %
        \startxrow %
          \startxcell Roman \stopxcell %
          \startxcell \tt rm, roman, serif, regular \stopxcell %
        \stopxrow %
        \startxrow %
          \startxcell Sans Serif \stopxcell %
          \startxcell \tt ss, sans, support, sansserif\stopxcell %
        \stopxrow %
        \startxrow %
          \startxcell Monospace \stopxcell %
          \startxcell \tt tt, mono, type, teletype \stopxcell %
        \stopxrow %
        \startxrow %
          \startxcell Manuscrite \stopxcell %
          \startxcell \tt hw, handwritten \stopxcell %
        \stopxrow %
        \startxrow [bottomframe=on]%
          \startxcell Calligraphique\stopxcell %
          \startxcell \tt cg, calligraphic\stopxcell %
        \stopxrow %
      \stopxtable} %
  }

Pour autant que je sache, les différents noms utilisés pour chacun des styles sont totalement synonymes.

\stopitemize

\startsubsubject
  [
    reference=sec:see-font,
    title=Visualiser une police,
  ]

Avant de décider d'utiliser une police particulière dans notre document, nous voudrions normalement voir à quoi elle ressemble. Cela peut presque toujours être fait à partir du système d'exploitation car il existe généralement un utilitaire permettant d'examiner l'apparence des polices installées sur le système ; mais pour plus de commodité, \ConTeXt\ lui-même offre un utilitaire qui nous permet de voir l'apparence de n'importe quelle police activée dans \ConTeXt. Il s'agit de \tex{showbodyfont}, qui génère un tableau avec des exemples de la police que nous indiquons.

Le format de \tex{showbodyfont} est le suivant :

\placefigure [here,none] [] {}{
\startDemoI
\showbodyfont [Options]
\stopDemoI}


où nous pouvons indiquer comme options précisément les mêmes noms symboliques que dans \tex{setupbodyfont}. Ainsi, l'exemple affiché nous montre différentes illustrations des polices schola et adventor avec une taille de base de 14 points.

\placefigure [here,none] [] {}{
\startDemoHW
\definebodyfontenvironment[14pt]
\showbodyfont[schola,14pt]
\blank[big]
\showbodyfont[adventor,14pt]
\stopDemoHW}

Notez qu'il y a certaines commandes dans la première ligne et la première colonne du tableau. Plus loin, lorsque la signification de ces commandes aura été expliquée, nous examinerons à nouveau les tableaux générés par \tex{showbodyfont}.

Si nous voulons voir la gamme complète des caractères d'une police spécifique, nous pouvons utiliser la commande \PlaceMacro{showfont}\tex{showfont[FontName]}. Cette commande affichera le dessin principal de chacun des caractères sans appliquer les commandes de styles et d'alternatives.

\placefigure [here,none] [] {}{
\startDemoHN
\showfont[texgyreadventorregular]
\stopDemoHN}


\stopsubsubject

\stopsection

% * SECTION 6.4 modification

\startsection
  [title=Modification de la police ou de certaines de ses caractéristiques]

% ** Subsection setup et switch body font

\startsubsection
  [title=Les commandes \tex{setupbodyfont} et \tex{switchtobodyfont}]
\PlaceMacro{switchtobodyfont}\PlaceMacro{setupbodyfont}

Pour changer la police, le style ou la taille, nous pouvons utiliser la même commande avec laquelle nous avons établi la police au début du document, lorsque nous ne voulons pas utiliser la police par défaut de \ConTeXt\ : \tex{setupbodyfont}. Il suffit de placer cette commande à l'endroit du document où l'on souhaite changer de police. Elle produira un changement de police {\em permanent}, ce qui signifie qu'elle affectera directement la police principale et indirectement toutes les polices qui lui sont liées.

 \tex{switchobodyfont} est très similaire à \tex{setupbodyfont}. Les deux commandes nous permettent de modifier les mêmes aspects de la police (la police elle-même, le style et la taille) mais, en interne, elles fonctionnent différemment et sont destinées à des utilisations différentes. La première (\tex{setupbodyfont}) sert à établir la police principale (et normalement la seule) du document ; il n'est ni courant ni correct d'un point de vue typographique qu'un document ait plus d'une police principale (c'est pourquoi elle est appelée police principale). En revanche, \tex{switchtobodyfont} est destiné à écrire certaines parties d'un texte dans une police différente, ou à affecter une police particulière à un type spécial de paragraphe que nous voulons définir dans notre document.

En dehors de ce qui précède -- qui affecte en fait le fonctionnement interne de chacune de ces deux commandes -- du point de vue de l'utilisateur, il existe quelques différences entre l'utilisation de l'une ou l'autre commande. En particulier :


\startitemize[n]

\item Comme nous le savons déjà, \tex{setupbodyfont} est limitée à une gamme particulière de tailles, alors que \tex{switchtobodyfont} nous permet d'indiquer pratiquement n'importe quelle taille, de sorte que si la police n'est pas disponible dans cette taille, elle s'y adaptera.

\item \tex{switchtobodyfont} n'affecte pas les éléments textuels autrement que là où il est utilisé, contrairement à \tex{setupbodyfont} qui, comme mentionné ci-dessus, établit la police principale et, en la modifiant, modifie également la police de tous les éléments textuels dont la police est calculée sur la base de la police principale.

\stopitemize

Ces deux commandes, en revanche, modifient non seulement la police, le style et la taille, mais aussi d'autres aspects associés à la police comme, par exemple, l'interligne. 

\placefigure [here,none] [] {}{
\startDemoVN
\setupbodyfont[modern]
Coucou
\switchtobodyfont[17.5pt]
Coucou
\stopDemoVN}

\placefigure [here,none] [] {}{
\startDemoVN
\setupbodyfont[modern,17.5pt]
Coucou 
% 17.5pt n'est pas autorisé
% modern n'est pas chargé
% on reste ici en Pagella
\switchtobodyfont[17.5pt]
Coucou
\stopDemoVN}

\startSmallPrint

\tex{setupbodyfont} génère une erreur de compilation si une taille de police non autorisée est demandée ; mais n'en génère pas si une police inexistante est demandée, auquel cas la police par défaut ({\em Latin Modern Roman}) sera activée. \tex{switchtobodyfont} agit de la même manière en ce qui concerne la police, et en termes de taille, comme je l'ai déjà dit, essaie d'y parvenir en mettant la police à l'échelle. Cependant, il existe des polices qui ne peuvent pas être mises à l'échelle dans certaines tailles, auquel cas la police par défaut sera à nouveau activée. 

\stopSmallPrint

\stopsubsection

% ** Subsection quick change

\startsubsection
  [
    reference=sec:quick-change,
    title={Changement rapide de style, d'alternative et de taille},
  ]

\subsubsubject{Changement de style et de style alternatif}

Outre \tex{switchtobodyfont}, \ConTeXt\ fournit un ensemble de commandes qui nous permettent de changer rapidement le style, le style alternatif ou la taille. En ce qui concerne ces commandes, le wiki \ConTeXt\ nous avertit que parfois, lorsqu'elles apparaissent au début d'un paragraphe, elles peuvent produire des effets secondaires indésirables, et recommande donc que dans ce cas, la commande en question soit précédée de la commande \PlaceMacro{dontleavehmode}\tex{dontleavehmode}.


{\switchtobodyfont[small] %
\placetable[here][tab:ctx-styles]
  {Commandes pour changer de styles}
  {
    \starttabulate[|l|l|]
      \HL
      \NC {\bf Style} \NC {\bf Commandes qui l'active}\NR
      \HL
      \NC {\rm Romain} \NC\type{\rm}, \type{\roman}, \type{\serif}, \type{\regular}\NR\PlaceMacro{rm}\PlaceMacro{roman}\PlaceMacro{serif}\PlaceMacro{regular}
      \NC {\ss Sans Serif}\NC\type{\ss}, \type{\sans}, \type{\support}, \type{\sansserif}\NR\PlaceMacro{ss}\PlaceMacro{sans}\PlaceMacro{support}\PlaceMacro{sansserif}
      \NC {\tt Monospace}\NC\type{\tt}, \type{\mono}, \type{\teletype},\NR\PlaceMacro{tt}\PlaceMacro{mono}\PlaceMacro{teletype}
      \NC {\hw Handwritten}\NC\type{\hw}, \type{\handwritten},\NR\PlaceMacro{hw}\PlaceMacro{handwritten}
      \NC {\cg Calligraphique}\NC\type{\cg}, \type{\calligraphic}\PlaceMacro{cg}\PlaceMacro{calligraphic}\NR
      \HL
    \stoptabulate
  }}

% TODO Garulfo : ce n'était pas \cf mais \cg

\in{Table}[tab:ctx-styles] contains the commands that allow us to change
style, without altering any other aspect; and
\in{table}[tab:ctx-alternatives] contains the commands that allow us to
exclusively alter the alternative.


{\switchtobodyfont[small] %
  \placetable[here][tab:ctx-alternatives]
  {Commandes pour changer de style alternatif}
  {
    \starttabulate[|l|l|]
      \HL
      \NC {\bf Style alternative} \NC {\bf Commandes qui l'active}\NR
      \HL
      \NC Normal           \NC\type{\tf}, \type{\normal}\NR\PlaceMacro{tf}\PlaceMacro{normal}
      \NC {\it Italique}          \NC\type{\it}, \type{\italic}\NR\PlaceMacro{it}\PlaceMacro{italic}
      \NC {\bf Gras}          \NC\type{\bf}, \type{\bold}\NR\PlaceMacro{bf}\PlaceMacro{bold}
      \NC {\bi Gras-italique}  \NC\type{\bi}, \type{\bolditalic}, \type{\italicbold}\NR\PlaceMacro{bi}\PlaceMacro{bolditalic}\PlaceMacro{italicbold}
      \NC {\sl Oblique}        \NC\type{\sl}, \type{\slanted}\NR\PlaceMacro{sl}\PlaceMacro{slanted}
      \NC {\bs Gras-oblique} \NC\type{\bs}, \type{\boldslanted}, \type{\slantedbold}\NR\PlaceMacro{bs}\PlaceMacro{boldslanted}\PlaceMacro{slantedbold}
      \NC {\sc Petites majuscules}      \NC\type{\sc}, \type{\smallcaps}\NR\PlaceMacro{sc}\PlaceMacro{smalcaps}
      \NC {\os Mediéval}         \NC\type{\os}, \type{\mediaeval}\PlaceMacro{os}\PlaceMacro{mediaeval}\NR
    \stoptabulate
  }
}

Toutes ces commandes conservent leur efficacité jusqu'à ce qu'un autre style ou une autre alternative soit explicitement activé(e), ou jusqu'à ce que le {\em groupe} dans lequel la commande est déclarée se termine. Par conséquent, lorsque nous voulons que la commande n'affecte qu'une partie du texte, nous devons entourer cette partie d'un groupe, comme dans l'exemple suivant, où chaque fois que le mot {\em pensée} apparaît alors qu'il s'agit d'un nom et non d'un verbe, il est en italique, ce qui crée un groupe pour lui.


\placefigure [here,none] [] {}{
\startDemoHN
J'ai pensé à une {\it pensée}, mais la  {\it pensée} que j'ai pensé n'était pas la {\it pensée} que je pensais avoir pensé. Si la  {\it pensée} que je pensais avoir pensé avait été la {\it pensée} que je pensais je n'aurais pas pensé autant !
\stopDemoHN}



\subsubsubject[sec:sufijos de tamaño]{Commandes pour changer d'alternative et de taille en même temps}
\PlaceMacro{rmx}\PlaceMacro{rmxx}\PlaceMacro{rma}\PlaceMacro{rmb}\PlaceMacro{rmc}\PlaceMacro{rmd}
\PlaceMacro{ssx}\PlaceMacro{ssxx}\PlaceMacro{ssa}\PlaceMacro{ssb}\PlaceMacro{ssc}\PlaceMacro{ssd}
\PlaceMacro{ttx}\PlaceMacro{ttxx}\PlaceMacro{tta}\PlaceMacro{ttb}\PlaceMacro{ttc}\PlaceMacro{ttd}
\PlaceMacro{tfx}\PlaceMacro{tfxx}\PlaceMacro{tfa}\PlaceMacro{tfb}\PlaceMacro{tfc}\PlaceMacro{tfd}
\PlaceMacro{itx}\PlaceMacro{itxx}\PlaceMacro{ita}\PlaceMacro{itb}\PlaceMacro{itc}\PlaceMacro{itd}
\PlaceMacro{bfx}\PlaceMacro{bfxx}\PlaceMacro{bfa}\PlaceMacro{bfb}\PlaceMacro{bfc}\PlaceMacro{bfd}
\PlaceMacro{bix}\PlaceMacro{bixx}\PlaceMacro{bia}\PlaceMacro{bib}\PlaceMacro{bic}\PlaceMacro{bid}
\PlaceMacro{slx}\PlaceMacro{slxx}\PlaceMacro{sla}\PlaceMacro{slb}\PlaceMacro{slc}\PlaceMacro{sld}
\PlaceMacro{bsx}\PlaceMacro{bsxx}\PlaceMacro{bsa}\PlaceMacro{bsb}\PlaceMacro{bsc}\PlaceMacro{bsd}


Les commandes qui modifient le style alternatif dans leur version à deux lettres (\tex{tf}, \tex{it}, \tex{bf}, etc.) acceptent aussi une gamme de {\em suffixes} qui affectent la taille de la police. 

Les suffixes a, b, c et d augmentent la taille initiale de police en la multipliant respectivement par $1.200^1=1.200$, $1.200^2=1.440$, $1.200^3=1.728$, et $1.200^4=2.074$). Les suffixes x et xx réduisent la taille des caractères, en la multipliant respectivement par $0.8$ et $0.6$. Voici une illustration~:

\placefigure [here,none] [] {}{
\startDemoHN%
\setupbodyfont[modern,12pt]%
{\tfxx test}, {\tfx test}, {\tf test}, {\tfa test}, {\tfb test}, {\tfc test}, {\tfd test}

{\tfxx test}, {\itx test}, {\bf test}, {\bia test}, {\slb test}, {\scc test}, {\ttd test}
\stopDemoHN}

\startSmallPrint

Les suffixes \quote{x} et \quote{xx} appliqués à \tex{tf} autorisent de raccourcir la commande, de sorte que \tex{tfx} peut s'écrire \PlaceMacro{tx}\tex{tx} et \tex{tfxx} \PlaceMacro{txx}\tex{txx}.

\stopSmallPrint

La disponibilité de ces différents suffixes dépend de l'implémentation réelle de la police. Selon le manuel de référence \ConTeXt{} 2013 (destiné principalement à Mark~II), le seul suffixe dont le fonctionnement est garanti est \quote{x}, et les autres peuvent être implémentés ou non ; ou ils peuvent l'être seulement pour certaines alternatives.

En tout cas, pour éviter les doutes, on peut utiliser \tex{showbodyfont} dont j'ai parlé précédemment (dans \in{section}[sec:see-font]). Cette commande affiche un tableau qui nous permet non seulement d'apprécier l'apparence de la police, mais aussi de visualiser la police dans chacun de ses styles et alternatives, ainsi que les suffixes de redimensionnement disponibles.

Examinons à nouveau le tableau montrant \tex{showbodyfont} pour la police {\em Latin Modern}~:

\placefigure [here,none] [] {}{
\startDemoHW
\definebodyfontenvironment[14pt]
\showbodyfont[modern,14pt]
\stopDemoHW}


Si l'on regarde attentivement le tableau, on constate que la première colonne contient les styles de police (\tex{rm}, \tex{ss} et \tex{tt}). La première ligne contient, à gauche, les styles alternatifs (\tex{tf}, \tex{sc}, \tex{sl}, \tex{it}, \tex{bf}, \tex{bs} et \tex{bi}), tandis que le côté droit de la première ligne contient les autres suffixes disponibles, mais uniquement avec le style alternatif régulier, ou normal.

Il est important de noter qu'un changement de taille de police effectué par l'un de ces suffixes ne modifiera que la taille de la police au sens strict, laissant intactes les autres valeurs normalement associées à la taille de la police, comme l'interligne.

\subsubsubject{Personnalisation des facteurs d'échelle et des suffixes}
  
Pour personnaliser le facteur d'échelle, nous pouvons utiliser \PlaceMacro{definebodyfontenvironment}\tex{definebodyfontenvironment} (déjà vu précédemment pour déclarer la taille de la police) dont le format peut être :

\placefigure [here,none] [] {}{
\startDemoI
\definebodyfontenvironment[particular size][scaled]
\definebodyfontenvironment[default][scaled]
\stopDemoI}

Dans la première version, nous redéfinissions la mise à l'échelle pour une taille particulière de la police principale définie par \tex{setupbodyfont} ou par \tex{switchtobodyfont}. Par exemple :

\placefigure [here,none] [] {}{
\startDemoI
\definebodyfontenvironment[10pt][a=12pt,b=14pt,c=2, d=3]
\stopDemoI}

ferait en sorte que, lorsque la police principale est de 10 points, le suffixe \quote{a} la change en 12 points, le suffixe \quote{b} en 14 points, le suffixe \quote{c} multiplie la police d'origine par $2.0$ et le suffixe \quote{d} par $3.0$. Notez que pour a et b, une dimension fixe a été indiquée, mais que pour c et d, un facteur de multiplication de la taille d'origine a été indiqué. 

Mais si le premier argument de \tex{definebodyfontenvironment} est égal à \MyKey{default}, alors nous redéfinirons la valeur de mise à l'échelle pour toutes les tailles de police possibles, et comme valeur de mise à l'échelle, nous ne pouvons entrer qu'un nombre multiplicateur. Ainsi, si, par exemple, nous écrivons :

\placefigure [here,none] [] {}{
\startDemoI
\definebodyfontenvironment[default][a=1.3,b=1.6,c=2.5,d=4]
\stopDemoI}

nous indiquons que, quelle que soit la taille de la police principale, le suffixe a doit être multiplié par $1.3$, le b par $1.6$, le c par $2.0$ et le d par $4.0$.

Outre les suffixes xx, x, a, b, c et d, la commande \tex{definebodyfontenvironment} permet d'attribuer une valeur d'échelle aux mots clés \MyKey{big}, \MyKey{small}, \MyKey{script} et \MyKey{scriptscript}. Ces valeurs sont attribuées à toutes les tailles associées à ces mots clés dans \tex{setupbodyfont} et \tex{switchobodyfont}. Elles sont également appliquées dans les commandes suivantes, dont l'utilité peut être déduite (je pense) de leur nom~:

\startitemize[1,packed]

\item \PlaceMacro{smallbold}\tex{smallbold}
\item \PlaceMacro{smallslanted}\tex{smallslanted}
\item \PlaceMacro{smallboldslanted}\tex{smallboldslanted}
\item \PlaceMacro{smallslantedbold}\tex{smallslantedbold}
\item \PlaceMacro{smallbolditalic}\tex{smallbolditalic}
\item \PlaceMacro{smallitalicbold}\tex{smallitalicbold}
\item \PlaceMacro{smallbodyfont}\tex{smallbodyfont}
\item \PlaceMacro{bigbodyfont}\tex{bigbodyfont}
  
\stopitemize

Si nous voulons voir les tailles par défaut d'une police particulière, nous pouvons utiliser \PlaceMacro{showbodyfontenvironment} \tex{showbodyfontenvironment[Font]}. Cette commande, appliquée à la police {\tt modern}, par exemple, donne le résultat suivant :

\placefigure [here,none] [] {}{
\startDemoHW
\definebodyfontenvironment[12pt]
\showbodyfontenvironment[modern,12pt]
\stopDemoHW}


\stopsubsection

% ** Subsection définir ses commandes et mots clés 

\startsubsection
  [title={Définition de commandes et de mots clés pour les tailles, les styles et les styles alternatifs de polices}]

Les commandes prédéfinies pour modifier la taille, les styles et les variantes des polices sont suffisantes. De plus, \ConTeXt\ nous permet :

\startitemize[n]

\item d'ajouter notre propre commande de changement de style, de taille ou de style alternatif de police.

\item d'ajouter des synonymes aux noms de styles ou de styles alternatifs reconnus par \tex{switchtobodyfont}.
  
\stopitemize

\ConTeXt\ fournit les commandes suivantes pour ce faire~:

\startitemize

\item \PlaceMacro{definebodyfontswitch} \tex{definebodyfontswitch} : nous permet de définir une commande pour changer la taille de la police. Par exemple, si nous voulons définir la commande \tex{eight} (ou la commande \tex{viii}\footnote{Nous rappelons que, sauf dans le cas des symboles de contrôle, les noms des commandes \ConTeXt\ peuvent uniquement être composés de lettres.}) pour définir une police de 8 points, nous devons écrire :

\placefigure [here,none] [] {}{
\startDemoVW
\definebodyfontswitch[quatorze][14pt]
\definebodyfontswitch[xxii][22pt]
{coucou} {\quatorze coucou} {\xxii coucou}
\stopDemoVW}

\item \PlaceMacro{definefontstyle}\tex{definefontstyle} : permet de définir un ou plusieurs mots qui peuvent être utilisés dans \tex{setupbodyfont} ou \tex{switchtobodyfont} pour définir un style de police particulier ; ainsi, par exemple, si nous voulons appeler la police {\em sans sérif} autrement (par exemple, en français, nous pourrions l'appeler \quotation{lineale} ou \quotation{sansempattement}), nous pouvons créer des synonymes en écrivant~:

\placefigure [here,none] [] {}{
\startDemoVW
\setupbodyfont[modern,12pt]%
\definefontstyle[lineale,sansempattement][ss]
coucou
\setupbodyfont[lineale]
coucou
\stopDemoVW}


\item \PlaceMacro{definealternativestyle} \tex{definealternativestyle}~: permet d'associer un nom à un style alternatif de police. Ce nom peut fonctionner comme une commande ou être reconnu par l'option {\tt style} des commandes qui nous permettent de configurer le style à appliquer. Ainsi, par exemple, le fragment suivant

\placefigure [here,none] [] {}{
\startDemoVW
\setupbodyfont[modern,12pt]
\definealternativestyle[strong][\bf][]
coucou \strong coucou
\stopDemoVW}

activera la commande \tex{strong} et le mot clé \MyKey{strong} qui sera reconnu par l'option {\tt style} des commandes qui autorisent cette option. Nous aurions pu dire \quotation{bold} mais ce mot est déjà utilisé pour ConTeXt, j'ai donc choisi un terme utilisé en HTML, à savoir, \quotation{strong} comme alternative.

  \startSmallPrint

Je ne sais pas ce que fait le troisième argument de \tex{definealternativestyle}. Il n'est pas optionnel et ne peut donc pas être omis ; mais la seule information que j'ai trouvée à ce sujet se trouve dans le manuel de référence \ConTeXt\ où il est dit que ce troisième argument ne concerne que les titres de chapitre et de section \quotation{\em où, en dehors de \tex{cap}, nous devons respecter la police utilisée ici}. ( ??)

  \stopSmallPrint

\stopitemize

\stopsubsection

\stopsection

% * SECTION 6.5 autres besoins sur les styles alternatifs 

\startsection
  [title=Autres questions relatives à l'utilisation de styles alternatifs]

Parmi les différents styles alternatifs d'une police de caractères, il en existe deux dont l'utilisation nécessite certaines précisions~:

% ** Subsection mise en valeur

\startsubsection
  [
    reference=sec:emphasis,
    title={Italique, oblique et mise en valeur},
  ]

L'italique et l'oblique sont utilisées principalement pour mettre en évidence un fragment de texte afin d'attirer l'attention sur celui-ci. En d'autres termes, pour le mettre en valeur.

Nous pouvons, bien sûr, mettre en valeur un texte en activant explicitement l'italique ou l'oblique. Mais \ConTeXt\ offre une commande alternative qui est beaucoup plus utile et intéressante et qui est destinée spécifiquement à mettre en valeur un fragment de texte. Il s'agit de la commande \PlaceMacro{em}\tex{em} du mot {\em emphasis}. Contrairement à \tex{it} et \tex{sl}, qui sont des commandes purement typographiques, \tex{em} est une commande {\em conceptuelle} ; elle fonctionne différemment et est plus polyvalente, au point que la documentation \ConTeXt\ recommande d'utiliser \tex{em} de préférence à \tex{it} ou \tex{sl}. Lorsque nous utilisons ces deux dernières commandes, nous indiquons à \ConTeXt\ quelle alternative de police nous voulons utiliser ; mais lorsque nous utilisons \tex{em}, nous lui indiquons l'effet que nous voulons produire, en laissant à \ConTeXt\ le soin de décider comment le faire.  Normalement, pour obtenir l'effet de mise en valeur de quelque chose, nous activerions l'italique ou l'oblique, mais cela dépend du contexte. Ainsi, si nous utilisons \tex{em} dans un texte qui est déjà en italique -- ou oblique -- la commande le mettra en évidence de la manière opposée -- en texte droit normal dans ce cas.

D'où l'exemple suivant :

\placefigure [here,none] [] {}{
\startDemoVW
{\it L'une des plus belles 
orchidées du monde est la 
{\em Thelymitra variegata} 
ou Reine de Saba du Sud.}
\stopDemoVW}

Notez que le premier \tex{em} active l'italique (en fait, l'oblique, mais voir ci-dessous) et que le second \tex{em} le désactive et place les mots \quotation{Thelymitra variegata} dans un style droit normal.

Un autre avantage de \tex{em} est qu'il ne s'agit pas d'un style alternatif, donc il ne désactive pas l'alternative que nous avions auparavant et donc, par exemple, dans un texte qui est en gras, avec \tex{em} nous obtiendrons du gras oblique sans avoir besoin de faire explicitement appel à \tex{bs}. De même, si la commande \tex{bf} apparaît dans un texte qui est déjà mise en valeur, celle-ci ne cessera pas.

\placefigure [here,none] [] {}{
\startDemoVW
{\bf L'une des plus belles 
orchidées du monde est la 
{\em Thelymitra variegata} 
ou Reine de Saba du Sud.}
\stopDemoVW}


Par défaut, \tex{em} active le gras oblique plutôt que l'italique, mais nous pouvons modifier cela avec \tex{setupbodyfontenvironment[default][em=italic]}.

\stopsubsection

% ** Subsection petites majuscules

\startsubsection
  [
    reference=sec:smallcaps,
    title=Petites majuscules et fausses petites majuscules,
  ]

Les petites majuscules sont une ressource typographique qui est souvent bien meilleure que l'utilisation des lettres majuscules (capitales). Les petites majuscules nous donnent la forme de la lettre majuscule mais conservent la même hauteur que les lettres minuscules sur la ligne. C'est pourquoi les petites majuscules sont un style alternatif des minuscules. Les petites majuscules remplacent les majuscules dans certains contextes, et sont particulièrement utiles pour écrire les chiffres romains ou les titres de chapitres. Dans les textes universitaires, il est également d'usage d'utiliser les petites majuscules pour écrire le nom des auteurs cités.

Le problème est que toutes les polices de caractères n'intègrent pas les petites majuscules, et celles qui le font ne le font pas toujours pour l'ensemble de leurs styles de police. De plus, les petites majuscules  étant une alternative à l'italique, au gras ou à l'oblique, selon les règles générales que nous avons énoncées dans ce chapitre, toutes ces caractéristiques typographiques ne peuvent être utilisées simultanément.

Ces problèmes peuvent être résolus par l'utilisation de {\em fausses petites capitales} que \ConTeXt\ nous permet de créer avec les commandes \tex{cap} et \tex{Cap} ; à cet égard, voir \in{section}[sec:Upper-Lower-Fake].

\stopsubsection

\stopsection

% * SECTION 6.6 Utilisation des couleurs 

\startsection
  [title=Use and configuration of colours]

\ConTeXt\ provides commands for changing the colour of an entire
document, some of its elements, or certain parts of the text. It also
provides commands for uploading hundreds of predefined colours into
memory, and for seeing what their components are.

% ** Subsection écrire une partie en couleur 

\startsubsection
  [title=Procedures for typesetting text fragments in colour]

Most of \ConTeXt's configurable commands allow an option called
\MyKey{color} that allows us to indicate the colour in which the text
affected by that command should be written. Thus, for example, to
indicate that chapter titles are written in blue, we only need to write:

\vbox{\starttyping
  \setuphead
    [chapter]
    [color=blue]
\stoptyping}

Using this procedure we can colour titles, headings, footnotes, margin
notes, bars and lines, tables, table or image titles, etc. The advantage
of using this procedure is that the final result will be consistent (all
texts that fulfil the same function will be written with the same
colour) and easier to change globally. 

We can also colour a portion or fragment of text directly, although, to
avoid a too-variegated use of colours, which is not pleasant from a
typographical perspective, or an inconsistent use, in general it is
recommended to avoid direct colouring and to use what we could call {\em
semantic colouring}, that is, instead of, for example, writing

\type{\color[red]{Very important text}}

we define a command for very important text that is given a colour. For
example

\starttyping
\definehighlight[important][color=red]
\important{Very important text}
\stoptyping

\stopsubsection

% ** Subsection fond et devant en couleur 

\startsubsection
  [title=Changing the document's background and foreground colour]
\PlaceMacro{setupbackgrounds}\PlaceMacro{setupcolors}

If we want to change the colour of the whole document, depending on
whether we want to alter the colour of the background or the colour of
the foreground (text), we will use \tex{setupbackgrounds} or
\tex{setupcolors}. So, for example

\starttyping
\setupbackgrounds
  [page]
  [background=color,backgroundcolor=blue]
\stoptyping

This command will set the background colour of pages as blue. As a value
for \MyKey{backgroundcolor} we can use the name of any of the predefined
colours.

To globally change the foreground colour throughout the document (from
the point where the command is inserted) use \tex{setupcolors}, where
the \MyKey{textcolor} option controls the text colour. For example:

\type{\setupcolors[textcolor=red]}

will see that the text colour is red.

\stopsubsection

% ** Subsection commandes pour mettre en couleur des textes particuliers


\startsubsection
  [title=Commands for colouring particular text\\ fragments]
\PlaceMacro{color}\PlaceMacro{colored}

The general command for colouring small portions of text is

\type{\color[ColourName]{Text to colour}}

For larger portions of text it is preferable to use

\type{\startcolor[ColourName] ... \stopcolor}

Both are named after some predefined colour. If we want to define the
colour on the fly, we can use the \tex{colored} command. For example:

\startDoubleExample

\starttyping
Three \colored[r=0.1, g=0.8, b=0.8]
{coloured} cats    
\stoptyping

Three \colored[r=0.1, g=0.8, b=0.8]{coloured} cats.
  
\stopDoubleExample

\stopsubsection

% ** Subsection les couleurs prédéfinies

\startsubsection
  [
    reference=sec:predefined-colours,
    title=Predefined colours,
  ]
  % This information comes from the reference manual. But I
  % suspect there are considerably more predefined colours. For
  % example the "maincolor" used in this document is based on
  % the orange not defined in the list of predefined colours.

  \ConTeXt\ loads the most common predefined colours listed in
  \in{table}[tbl:predefined colours].\footnote{This list can be found in the reference manual and \ConTeXt\ wiki but I am fairly sure it is an incomplete list since in this document, for example, without having loaded any additional colour, we use \quotation{orange} -- which is not in the \in{table}[tbl:predefined colours]-- for section titles.}

{\switchtobodyfont[small]
\placetable
  [here]
  [tbl:predefined colours]
  {\ConTeXt's predefined colours}
{\starttabulate[|l|l|l|l|]
\HL
\NC{\bf Name}
\NC{\bf Light tone}
\NC{\bf Medium tone}
\NC{\bf Dark tone}
\NR
\HL
\NC black
\NR
\NC white
\NR
\NC gray
\NC lightgray
\NC middlegray
\NC darkgray
\NR
\NC red
\NC lightred
\NC middlered
\NC darkred
\NR
\NC green
\NC lightgreen
\NC middlegreen
\NC darkgreen
\NR
\NC blue
\NC lightblue
\NC middleblue
\NC darkblue
\NR
\NC cyan
\NC\NC middlecyan
\NC darkcyan
\NR
\NC magenta
\NC\NC middlemagenta
\NC darmagenta
\NR
\NC yellow
\NC\NC middleyellow
\NC darkyellow
\NR
\HL
\stoptabulate
}}

There are other colour collections not loaded by default but which can
be loaded with the command

\PlaceMacro{usecolors}\type{\usecolors[CollectionName]}

where CollectionName can be 

\startitemize[packed]
\item \MyKey{crayola}, 235 colours imitating marker shades.
\item \MyKey{dem}, 91 colours.
\item \MyKey{ema}, 540 colour definitions based on colours used by Emacs.
\item \MyKey{rainbow}, 91 colours for use in maths formulas.
\item \MyKey{ral}, 213 colour definitions from the {\em Deutsches
  Institut für Gütesicherung und Kennzeichnung} (German Institute for Quality Assurance and Labelling).
\item \MyKey{rgb}, 223 colours.
\item \MyKey{solarized}, 16 colours based on the solarized scheme.
\item \MyKey{svg}, 147 colours.
\item \MyKey{x11}, 450 standard colours for X11.
\item \MyKey{xwi}, 124 colours.
\stopitemize

\startSmallPrint

  The colour definition files are included in the
  \MyKey{context/base/mkiv} directory of the distribution and its name
  responds to the \MyKey{colo-imp-NOMBRE.mkiv} scheme. The information I
  have just provided on the different collections of predefined colours
  is based on my particular distribution. The specific collections, or
  the number of colours defined in them, could change in future
  versions.

\stopSmallPrint

To see what colours each of these collections contains we can use the
\PlaceMacro{showcolor}\tex{showcolor[CollectionName]} command described
in what follows. To use some of these colours we first need to load them
into memory with the (\tex{usecolors[CollectionName]}) command and then
we have to tell the \tex{color} or
\PlaceMacro{startcolor}\tex{startcolor} commands the name of the colour.
For example the following sequence: \page[preference]

\placefigure [force,here,none] [] {}{
\startDemoHN%
\usecolors[xwi]
\color[darkgoldenrod]{Tweedledum and Tweedledee}
\stopDemoHN}


\stopsubsection

% ** Subsection visualiser les couleurs dispos

\startsubsection
  [title=To see available colours]
\PlaceMacro{showcolor}

The \tex{showcolor} command shows a list of colours in which you can see
the appearance of the colour, its appearance when the colour is used in
grey scale, the red, green and blue components of the colour, and the
name by which \ConTeXt\ knows it. Used without any argument
\tex{showcolor} will show the colours used in the current document. But
as an argument we can indicate any of the predefined collections of
colours that were discussed in \in{section}[sec:predefined-colours], and
so, for example, \tex{showcolor[solarized]} will show us the 16
solarized colours in that collection:

\showcolor[solarized]

If we want to see the rgb components of a particular colour, we can use
\PlaceMacro{showcolorcomponents}\tex{showcolorcomponents[ColourName]}.
This is useful if we are trying to define a specific colour, to see the
composition of some colour that is close to it. For example,
\tex{showcolorcomponents[darkgoldenrod]} will show us:

\startframedtext[width=\textwidth]\switchtobodyfont[small]
\showcolorcomponents[darkgoldenrod]
\stopframedtext

\stopsubsection

% ** Subsection définir ses propres couleurs 

\startsubsection
  [title=Defining our own colours]
\PlaceMacro{definecolor}

\tex{definecolor} allows us to either clone an existing colour or define
a new colour. Cloning an existing colour is as simple as creating an
alternative name for it. To do this you would have to write:

\type{\definecolor[New colour][Old colour]}

This will ensure that “{\em New colour}” is exactly the same colour as
“{\em Old colour}”.

But the main use of \tex{definecolor} is for creating new colours. To do
so the command must be used in the following way:

\type{\definecolor[ColourName][Definition]}

where {\em Definition} can be done by applying up to six different
colour generation schemes:

\startitemize

\item {\bf RGB colours}: The definition of RGB colours is one of the
most widespread; it is based on the idea that it is possible to
represent a colour by mixing, by addition, the three primary colours:
red (\quote{r} for {\em red}), green (\quote{g} for {\em green}) and
blue (\quote{b} for {\em blue}). Each of these components is indicated
as a decimal number between 0 and 1.

  \type{\definecolor[lime 1][r=0.75, g=1, b=0]}: \definecolor[lime 1]
       [r=0.75, g=1, b=0] \color[lime 1]{Text in “lime 1”}.

\item {\bf Hex colours}: This way of representing the colours is also
based on the RGB scheme, but the red, green and blue components are
indicated as a three-byte hexadecimal number in which the first byte
represents the value of red, the second the value of green and the third
the value of blue. For example:

  \type{\definecolor[lime 2][x=BFFF00]}: \definecolor[lime 2][x=BFFF00]
  \color[lime 2]{Text in “lime 2”}.

\item {\bf CMYK colours}: This model of colour generation is what is
called a \quotation{subtractive model} and is based on the mixture of
pigments of the following colours: cyan (\quote{c}), magenta
(\quote{m}), yellow (\quote{y}, from {\em yellow}) and black (\quote{k},
from {\em key}). Each of these components is indicated as a decimal
number between 0 and 1:

  \type{\definecolor[lime 3][c=0.25, m=0, y=1, k=0]}:
  \definecolor[lime 3][c=0.25, m=0, y=1, k=0] \color[lime 3]{Text in
   “lime 3”}.

\item {\bf HSL/HSV}: This colour model is based on measuring the hue
(\quote{h}, from {\em hue}), saturation (\quote{s}) and luminescence
(\quote{l} or sometimes \quote{v}, from {\em value}). Hue corresponds to
a number between 0 and 360; saturation and luminescence must be a
decimal number between 0 and 1. For example

  \type{\definecolor[lime 4][h=75, s=1, v=1]}: \definecolor[lime
    4][h=75, s=1, v=1] \color[lime 4]{Text in “lime 4”}

\item {\bf HWB colours}: The HWB model is a suggested standard for CSS4
which measures the hue (\quote{h}, from {\em hue}), and the level of
white (\quote{w}, from {\em whiteness}) and black (\quote{b}, from {\em
blackness}). Hue corresponds to a number between 0 and 360, while
whiteness and blackness are represented by a decimal number between 0
and 1.

  \type{\definecolor[Azure][h=75, w=0.2, b=0.7]}
  \definecolor[Azure][h=75, w=0.2, b=0.7]\color[Azure]{Text in
   “Azure”}.

  % \type{\definecolor[lima 5][h=75, w=0, b=0]}
  % \definecolor[lima 5][h=75, w=0.2, b=0.7]\color[lima 5]{Texto en
  %   color “lima 5”}.

\item {\bf Greyscale}: based on a component called (\quote{s}, from {\em scale}) that measures the amount of grey. It needs to be a number between 0 and 1. For example:

  \type{\definecolor[light grey][s=0.65]}: \definecolor[light grey][s=0.65] \color[light grey]{Text in “light grey”}.
  
\stopitemize

It is also possible to define a new colour from another colour. For
example, the colour in which titles are written in this introduction is
defined as

\type{\definecolor[maincolour][0.6(orange)]}

\stopsubsection

\stopsection

% * SECTION 6.7 Utilisation des polices du système d'exploitation

% TODO Garulfo section ajoutée 

\startsection
 [title=Bonus 1 - Utilisation des polices du sytème d'exploitaion]

% ** Subsection emplacement des polices
\startsubsection
  [title=Emplacement des polices sur votre ordinateur]

La première étape consiste à déclarer les emplacements de stockage des polices que vous voulez que \ConTeXt\ prenne en compte.

Dans tous les cas, ConTeXt utilisera les polices correctement stockées dans son arborescence (par exemple, toutes les polices que vous auriez téléchargées à partir de 
\goto{Fonts Squirrel}[url(https://www.fontsquirrel.com)] ou encore
\goto{Google Fonts}[url(https://fonts.google.com)].

Les utilisateurs de TeX créent un nouveau dossier pour chaque nouvelle police dans \MyKey{tex/texmf-fonts/fonts/}, en suivant la 
\goto{structure de répertoire de \TeX}[url(http://tug.org/tds/)].
Cela aide les algorithmes à gérer l'incroyable variété de variables et de paramètres des polices. Les personnes qui manipulent beaucoup de polices peuvent être plus structurées en décomposant encore plus finement le chemin par exemple en utilisant \MyKey{tex/texmf-fonts/fonts/truetype/vendor/fontfamily}.

Mais il est très probable que vous souhaitiez également utiliser les polices déjà disponibles sur votre système d'exploitation~:

\index{mtxrun}
\index{fonts}
\index{fonts+OSFONTDIR}

\startitemize[n,packed]
\item Spécifiez où \ConTeXt\ doit chercher les polices, en définissant la variable d'environnement \MyKey{OSFONTDIR}.

\startitemize[packed]
\item WINDOWS : 
\placefigure [force,here,none] [] {}{
\startDemoC
set OSFONTDIR=c:/windows/fonts/
\stopDemoC}

\item MAC :
\placefigure [force,here,none] [] {}{
\startDemoC
export OSFONTDIR=/Library/Fonts/:/System/Library/Fonts:$HOME/Library/Fonts
\stopDemoC}

\item GNU/LINUX : 
\placefigure [force,here,none] [] {}{
\startDemoC
export OSFONTDIR=$HOME/.fonts:/usr/share/fonts
\stopDemoC}

\item Ajoutez-le à votre .bashrc ou à l'équivalent shell pour rendre la déclaration permanente.
\stopitemize

\item Lancez ConTeXt pour indexer les fichiers et les polices. 

\placefigure [force,here,none] [] {}{
\startDemoC
mtxrun --generate
mtxrun --script font --reload
\stopDemoC}

\item Vérifiez en cherchant la police spécifique que vous voulez utiliser ensuite. Un exemple courant

\placefigure [force,here,none] [] {}{
\startDemoC
mtxrun --script font --list --file -pattern=*helvetica*.
\stopDemoC}

\stopitemize

Maintenant, apprenons à les utiliser. 

\stopsubsection

% ** Subsection utilisation rapide

\startsubsection
  [title=Utilisation rapide d'une nouvelle police de caractères]

Prenons un exemple : nous voulons utiliser la police
\goto{Noto Serif}[url(https://fonts.google.com/specimen/Noto+Serif)].

Si elle est déjà installé sur votre ordinateur, et que vous avez déjà mis à jour les bases de données \ConTeXt\ comme indiqué précédemment, allez directement au point 2.

Sinon, vous devez d'abord la télécharger et la stocker. Le site de Google fournit un fichier zip avec les 4 variations alternatives (Regular 400, Regular 400 italic, Bold 700, Bold 700 italic). 

\startitemize[n,packed]
\item Stockez-les dans un dossier dédié indexé par \ConTeXt\ (voir ci-dessus).
  \startitemize[packed]
    \item par exemple, créez un répertoire \quotation{Noto-serif} dans la distribution \ConTeXt\ \MyKey{tex/texmf-fonts/fonts/} (ou bien, sous LINUX, dans \MyKey{~/.fonts}).
    \item dézippez et stockez les fichiers .ttf dans   \MyKey{tex/texmf-fonts/fonts/Noto-serif/}.
    \item Régénérer les bases de données ConTeXt

\placefigure [force,here,none] [] {}{
\startDemoC
mtxrun --generate
mtxrun --script font --reload
\stopDemoC}

  \stopitemize

\item Maintenant vous pouvez vérifier le nom de la police utilisé pour identifier les polices, en lançant le script mtxrun~:

\placefigure [force,here,none] [] {}{
\startDemoC
mtxrun --script fonts --list --all --pattern=*notoserif        
identifier            familyname  fontname             filename      subfont   instances

notoserif             notoserif   notoserif            NotoSerif-Regular.ttf
notoserifbold         notoserif   notoserifbold        NotoSerif-Bold.ttf
notoserifbolditalic   notoserif   notoserifbolditalic  NotoSerif-BoldItalic.ttf
notoserifitalic       notoserif   notoserifitalic      NotoSerif-Italic.ttf
\stopDemoC}

\PlaceMacro{\definedfont}

\item Vous pouvez maintenant utiliser la police n'importe où dans vos fichiers sources avec la commande \tex{definedfont[name:lefontname*default]} (il est bon d'ajouter \MyKey{*default} pour bénéficier des fonctionnalités par défaut, comme par exemple le crénage (kerning).

\placefigure [force,here,none] [] {}{
\startDemoHN%
\definedfont [name:notoserifbolditalic*default at 12 pt]%
Le renard brun et rapide saute par-dessus le chien paresseux.
\stopDemoHN}

\stopsubsection

% ** Subsection de divers styles alternatives

\startsubsection
  [title=Utilisation de divers styles alternatifs de police]

Il n'est pas agréable de devoir écrire \tex{definedfont[name:mapolice-graissestyle*default at xxpt]} chaque fois que vous voulez utiliser une police particulière. C'est pourquoi il est utile de définir un {\em typescript}. C'est juste 3 étapes, et moins de 5 minutes. Ensuite, vous pourrez facilement passer d'un style ou style alternative à l'autre avec les commandes vues précédemment, et toute la typographie de votre document utilisera un ensemble cohérent de polices.
\goto{De nombreuses polices de caractères}[url(https://wiki.contextgarden.net/Typescripts_examples)]
sont prêtes à être utilisées avec les polices libres et commerciales habituelles, et évidemment avec celle de \suite-.

\startitemize[n,packed]

\PlaceMacro{starttypescript}
\PlaceMacro{definefontsynonym}

\item Définissez un nouveau {\em typecript} dans votre fichier d'entrée, avec \tex{starttypescript}.

\startitemize[packed]
\item Définissez les liens entre les noms de fichiers et les noms lisibles par le public avec \tex{definefontsynonym}.
\item Dans cet exemple, le {\em typecript} s'appelle \MyKey{mynotoserif}.
\item Rappel : vous trouvez les noms de fichiers pour les polices Noto Serif avec 
\MyKey{mtxrun --script fonts --list --all --pattern=*notoserif}
\stopitemize

\placefigure [force,here,none] [] {}{
\startDemoI%
\starttypescript [mynotoserif]
% \definefontsynonym[Human readable]       [file:filename without extension]
  \definefontsynonym[NotoSerif-Regular]    [file:NotoSerif-Regular]
  \definefontsynonym[NotoSerif-Italic]     [file:NotoSerif-Italic]
  \definefontsynonym[NotoSerif-Bold]       [file:NotoSerif-Bold]
  \definefontsynonym[NotoSerif-BoldItalic] [file:NotoSerif-BoldItalic]
\stoptypescript
\stopDemoI}

C'est ici que vous pouvez identifier notamment les alternatives 
\quotation{thin},
\quotation{extralight},
\quotation{light},
\quotation{medium},
\quotation{semi-bold},
\quotation{extrabold},
\quotation{black},
\quotation{ultrablack},
\quotation{condensed},
\quotation{extracondensed}.

\item L'étape ennuyeuse, définir les liens entre les 
\goto{noms de base \ConTeXt}[url(https://github.com/contextgarden/context-mirror/blob/a0270f13065d116355a953c6f246cbba26289fc2/tex/context/base/mkiv/font-sel.lua#L514)]
 et les noms compréhensible par l'utilisateur. Une bonne habitude à prendre consiste à bien définir une solution de repli (au cas où la police indiquée ne serait pas accessible à \ConTeXt).

\placefigure [force,here,none] [] {}{
\startDemoI%
\starttypescript [mynotoserif]
  \setups[font:fallback:serif]          % security: if not found==> back to defaults
% \definefontsynonym[ConTeXt basics name] [Human readable]       [features=default]
  \definefontsynonym[Serif]                [NotoSerif-Regular]    [features=default]
  \definefontsynonym[SerifItalic]          [NotoSerif-Italic]     [features=default]
  \definefontsynonym[SerifBold]            [NotoSerif-Bold]       [features=default]
  \definefontsynonym[SerifBoldItalic]      [NotoSerif-BoldItalic] [features=default]
\stoptypescript
\stopDemoI}

\item Définir le pack des 4 styles alternatifs comme le caractère \quotation{romain} ou  \quotation{sérif} du {\em typecript} \quotation{mynotoserif}.

\placefigure [force,here,none] [] {}{
\startDemoI%
\starttypescript [mynotoserif]
  \definetypeface [mynotoserif]    [rm] [serif] [mynotoserif]    [default]
\stoptypescript
\stopDemoI}

\item au final, nous disposons maintenant d'un {\em typecript} utilisable~:

\placefigure [force,here,none] [] {}{
\startDemoHW%
\starttypescript [mynotoserif]
  \definefontsynonym[NotoSerif-Regular]    [file:NotoSerif-Regular]
  \definefontsynonym[NotoSerif-Italic]     [file:NotoSerif-Italic]
  \definefontsynonym[NotoSerif-Bold]       [file:NotoSerif-Bold]
  \definefontsynonym[NotoSerif-BoldItalic] [file:NotoSerif-BoldItalic]
\stoptypescript

\starttypescript [mynotoserif]
  \setups[font:fallback:serif]
  \definefontsynonym[Serif]                [NotoSerif-Regular]    [features=default]
  \definefontsynonym[SerifItalic]          [NotoSerif-Italic]     [features=default]
  \definefontsynonym[SerifBold]            [NotoSerif-Bold]       [features=default]
  \definefontsynonym[SerifBoldItalic]      [NotoSerif-BoldItalic] [features=default]
\stoptypescript

\starttypescript [mynotoserif]
  \definetypeface [mynotoserif]    [rm] [serif] [mynotoserif]    [default]
\stoptypescript

\setupbodyfont[mynotoserif]
\setupbodyfont[12pt]
{    The quick brown fox jumps over the lazy dog}\\
{\it The quick brown fox jumps over the lazy dog}\\
{\bf The quick brown fox jumps over the lazy dog}\\
{\bi The quick brown fox jumps over the lazy dog}\\
\stopDemoHW}

\item à vous de poursuivre pour construire un ensemble complet présentant les styles 
\quotation{Sans Serif}, 
\quotation{Monospace}, 
\quotation{Handwritten}, 
\quotation{Calligraphique}.
\stopitemize  
  
\stopsubsection

% ** Subsection typescript


\startsubsection
  [title=Installation d'un typecript pour l'utiliser partout]

  Vous voudrez probablement utiliser vos nouvelles définitions de caractères personnalisées dans différents documents, et vous devrez donc les installer dans la distribution. Ici, nous rappelons la définition : 

  \startitemize[packed]
\item Enregistrez votre fichier sous le nom de \MyKey{type-imp-(un nom quelconque).tex}, par exemple ici \MyKey{type-imp-mynotoserif.tex}.
\item Copiez les fichiers typescript dans \MyKey{tex/texmf-fonts/tex/context/user/}.
\item Exécutez \MyKey{context --generate} pour mettre à jour la base de données des fichiers \ConTeXt.
\item C'est fait ! Maintenant, deux lignes au début de n'importe quelle entrée déclareront qu'il faut composer avec les nouvelles polices :

\placefigure [force,here,none] [] {}{
\startDemoI%
\usetypescriptfile[mynotoserif] % this is the 'some-name-you-like' part of the saved filename
\setupbodyfont[mynotoserif]     % this is the first argument to \definetypeface
\stopDemoI}
\stopitemize

\stopsubsection

% ** Subsection Utilisation des features

\startsubsection
  [title=Quelques dernières fonctionnalités avec les polices]
  
Certaines polices proposent des \quotation{fonctionnalités} très spécifiques et chères aux amaterus typographes, voyez par exemple l'utilisation suivante avec la police Garamond Premier, qu'il faudrait développer petit à petit~:



\placefigure [force,here,none] [] {}{
\startDemoHN%
\definefontfeature
  [mesfeaturesA]
  [mode=node, 
   language=dflt, 
   protrusion=quality,  % for protrusion (dans les marges)
   expansion=quality,   % for expansions (expansion des lettres)
   script=latn, 
   kern=no,            % for kerning
   liga=no,            % ligatures communes
   dlig=no,            % ligatures spécifiques (exemple st) 
   calt=no,            % alternatives contextuelles
   lnum=yes,            % lining numbers
   onum=no,             % old style numbers,
   ccmp=no,            % petites majuscules
   ss04=no,            % stylistic swash
   ]
   
\definefontfeature
  [mesfeaturesB]
  [mode=node, 
   language=dflt, 
   protrusion=quality,  % for kerning
   expansion=quality,   % for kerning
   script=latn, 
   kern=yes,            % for kerning
   liga=yes,            % ligatures communes
   dlig=yes,            % ligatures spécifiques (exemple st) 
   calt=yes,            % alternatives contextuelles
   lnum=no,            % lining numbers
   onum=yes,             % old style numbers,
   ccmp=yes,            % petites majuscules
   ss04=yes,            % stylistic swash
   ]
    
\definedfont [name:garamondpremrpro*mesfeaturesA at 24 pt]%
st ffl fi fj fh Qu 0123456789

\definedfont [name:garamondpremrpro*mesfeaturesB at 24 pt]%
st ffl fi fj fh Qu 0123456789

\stopDemoHN}

\stopsubsection

\stopsection


% * END

\stopchapter

\stopcomponent


%%% Local Variables:
%%% mode: ConTeXt
%%% mode: auto-fill
%%% coding: utf-8-unix
%%% TeX-master: "../introCTX_fra.tex"
%%% End:
%%% vim:set filetype=context tw=72 : %%%
